# 鞋店管理系统 v1.5 角色简化更新

**更新日期:** 2025年12月31日  
**版本号:** v1.5.0  
**更新类型:** 角色架构优化

---

## 🎯 核心变更

### 简化角色体系

**之前：** 三级角色（管理员、店长、店员）  
**现在：** 两级角色（店长、店员）

---

## 📋 详细变更

### 1. 移除管理员角色

**原因：**
- 鞋店管理系统是小型商业应用
- 三级角色过于复杂，不符合实际使用场景
- 店长就是老板，应该拥有所有权限

**变更：**
```javascript
// 之前
export const ROLES = {
  ADMIN: 'admin',      // 管理员
  MANAGER: 'manager',  // 店长
  STAFF: 'staff'       // 店员
}

// 现在
export const ROLES = {
  MANAGER: 'manager',  // 店长 - 所有权限
  STAFF: 'staff'       // 店员 - 基本销售权限
}
```

### 2. 更新默认账户

**之前：**
- 管理员账号：admin / admin123
- 店长账号：luhongpeng / lu17303838326
- 店员账号：lhp / 123456

**现在：**
- 店长账号：luhongpeng / lu17303838326 ✅
- 店员账号：lhp / 123456 ✅

### 3. 权限调整

**店长权限：**
- ✅ 拥有所有权限（原管理员权限）
- ✅ 商品管理（增删改查）
- ✅ 进货管理
- ✅ 销售管理
- ✅ 会员管理（包括充值）
- ✅ 查看所有财务数据
- ✅ 查看所有员工业绩
- ✅ 用户管理
- ✅ 数据备份和恢复

**店员权限：**（无变化）
- ✅ 查看商品
- ✅ 销售开单
- ✅ 查看销售记录（无金额）
- ✅ 查看会员信息（无余额）
- ✅ 添加会员（无充值权限）
- ✅ 查看自己的业绩（无金额）

---

## 🔧 技术变更

### 修改的文件

1. **src/stores/user.js**
   - 移除 `ROLES.ADMIN`
   - 移除 `ROLE_NAMES.admin`
   - 店长权限改为 `Object.values(PERMISSIONS)`
   - 移除管理员默认账户
   - 更新 `isAdmin` 为 `isManager`
   - 更新所有管理员检查逻辑为店长检查

### 代码对比

#### 角色权限映射
```javascript
// 之前
const ROLE_PERMISSIONS = {
  [ROLES.ADMIN]: Object.values(PERMISSIONS),
  [ROLES.MANAGER]: [
    // 列出具体权限...
  ],
  [ROLES.STAFF]: [...]
}

// 现在
const ROLE_PERMISSIONS = {
  [ROLES.MANAGER]: Object.values(PERMISSIONS), // 店长拥有所有权限
  [ROLES.STAFF]: [...]
}
```

#### 检查函数
```javascript
// 之前
const isAdmin = computed(() => currentRole.value === ROLES.ADMIN)
const isManagerOrAbove = computed(() => 
  [ROLES.ADMIN, ROLES.MANAGER].includes(currentRole.value)
)

// 现在
const isManager = computed(() => currentRole.value === ROLES.MANAGER)
const isManagerOrAbove = computed(() => currentRole.value === ROLES.MANAGER)
```

#### 保护逻辑
```javascript
// 之前
if (user.role === ROLES.ADMIN) {
  return { success: false, message: '不能删除管理员账号' }
}

// 现在
if (user.id === '1') {
  return { success: false, message: '不能删除主店长账号' }
}
```

---

## 🎨 用户体验改进

### 登录界面
- 移除管理员账号提示
- 简化角色说明

### 用户管理
- 角色选择器只显示"店长"和"店员"
- 主店长账号受保护（不能删除/禁用/修改角色）

---

## ⚠️ 重要提醒

### 数据迁移

**如果您之前使用了管理员账号：**

1. **自动迁移：** 系统会自动更新默认用户
2. **手动清理：** 建议清除浏览器 localStorage 重新登录
3. **新登录：** 使用店长账号登录即可

### 清除缓存步骤

```javascript
// 在浏览器控制台执行
localStorage.clear()
// 然后刷新页面
```

或者：
1. 打开浏览器开发者工具（F12）
2. Application → Storage → Local Storage
3. 右键 → Clear
4. 刷新页面

---

## 📊 角色对比表

| 功能 | 店长 | 店员 |
|------|------|------|
| 查看商品 | ✅ | ✅ |
| 添加/编辑/删除商品 | ✅ | ❌ |
| 进货管理 | ✅ | ❌ |
| 销售开单 | ✅ | ✅ |
| 查看销售金额 | ✅ | ❌ |
| 删除销售记录 | ✅ | ❌ |
| 查看会员余额 | ✅ | ❌ |
| 会员充值 | ✅ | ❌ |
| 查看统计报表 | ✅ | ❌ |
| 查看所有员工业绩 | ✅ | ❌ |
| 用户管理 | ✅ | ❌ |
| 数据备份 | ✅ | ❌ |

---

## 🚀 升级指南

### 步骤 1：部署新版本
```bash
# 拉取最新代码
git pull

# 安装依赖（如有更新）
npm install

# 构建
npm run build
```

### 步骤 2：清除旧数据
- 建议所有用户清除浏览器缓存
- 重新登录系统

### 步骤 3：测试
- 使用店长账号测试所有功能
- 使用店员账号确认权限限制

---

## 💡 设计理念

### 为什么简化？

1. **符合实际场景**
   - 鞋店老板就是店长
   - 不需要额外的"管理员"角色
   - 简化用户理解成本

2. **降低复杂度**
   - 两级角色更清晰
   - 权限管理更简单
   - 减少混淆

3. **提升效率**
   - 店长直接拥有所有权限
   - 无需多层审批
   - 快速响应业务需求

---

## 🔒 安全性

### 主店长保护机制

系统会保护第一个店长账号（ID为'1'）：
- ❌ 不能删除
- ❌ 不能禁用
- ❌ 不能修改角色
- ✅ 可以修改密码
- ✅ 可以修改其他信息

### 其他店长账号

店长可以添加多个店长账号：
- ✅ 可以删除（除了主店长）
- ✅ 可以禁用
- ✅ 可以修改角色
- ✅ 拥有完全权限

---

## 📝 测试清单

### 店长账号测试
```
账号：luhongpeng
密码：lu17303838326
```

- [ ] 能够登录
- [ ] 能看到所有功能菜单
- [ ] 能查看所有财务数据
- [ ] 能管理用户
- [ ] 能备份数据

### 店员账号测试
```
账号：lhp
密码：123456
```

- [ ] 能够登录
- [ ] 看不到财务数据
- [ ] 看不到用户管理
- [ ] 能正常收银
- [ ] 能查看自己业绩（无金额）

---

## 🎉 总结

本次更新通过简化角色体系，使系统更符合小型鞋店的实际使用场景：

- ✅ **店长 = 老板**，拥有所有权限
- ✅ **店员 = 收银员**，只能销售和基本操作
- ✅ 权限清晰，易于理解
- ✅ 保护主店长账号安全
- ✅ 支持多店长管理

**这是一个更实用、更简洁的权限系统！** 🎯

---

**开发者：** AI Assistant  
**审核者：** 老板需求  
**发布日期：** 2025年12月31日

