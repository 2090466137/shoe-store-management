var k=(I,q,d)=>new Promise((m,r)=>{var f=u=>{try{s(d.next(u))}catch(p){r(p)}},c=u=>{try{s(d.throw(u))}catch(p){r(p)}},s=u=>u.done?m(u.value):Promise.resolve(u.value).then(f,c);s((d=d.apply(I,q)).next())});import{_ as L,i as j,j as E,r as g,k as w,c as P,d as l,b as a,l as V,a as H,e as v,w as y,f as Q,n as R,F as G,p as J,s as n,g as b,t as _,x as K,q as W}from"./index-iyMuq2FD.js";const X={class:"purchase-page page-container"},Y={class:"content-wrapper"},Z={class:"card"},O={style:{margin:"16px"}},ee={class:"card"},te={key:0,class:"empty-state"},se={class:"record-header"},oe={class:"record-product"},ae={class:"record-header-right"},ne={class:"record-amount"},le={class:"record-info"},ue={class:"record-footer"},re={class:"record-supplier"},ie={class:"record-date"},de={__name:"Purchase",setup(I){const q=H(),d=j(),m=E(),r=g(!1),f=g(""),c=g(null),s=g({productId:"",quantity:"",costPrice:"",supplier:""}),u=w(()=>d.getAllProducts.map(t=>({text:`${t.name} (è´§å·: ${t.code} | ${t.size}ç )`,value:t.id}))),p=w(()=>{const t=parseFloat(s.value.quantity)||0,e=parseFloat(s.value.costPrice)||0;return(t*e).toFixed(2)}),x=({selectedOptions:t})=>{const e=t[0].value;c.value=d.getProductById(e),c.value&&(s.value.productId=e,f.value=t[0].text,s.value.costPrice=c.value.costPrice.toString(),s.value.supplier=c.value.supplier||""),r.value=!1},C=t=>{const e=parseFloat(t);return!isNaN(e)&&e>0},$=t=>{const e=parseInt(t);return!isNaN(e)&&e>0&&Number.isInteger(parseFloat(t))},F=()=>{const t=parseInt(s.value.quantity);isNaN(t)||t<0?(s.value.quantity="1",n("è¿›è´§æ•°é‡ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Œå·²è°ƒæ•´ä¸º1")):t===0?(s.value.quantity="1",n("è¿›è´§æ•°é‡ä¸èƒ½ä¸º0ï¼Œå·²è°ƒæ•´ä¸º1")):Number.isInteger(parseFloat(s.value.quantity))?t>999999&&(s.value.quantity="999999",n("è¿›è´§æ•°é‡è¿‡å¤§ï¼Œå·²è°ƒæ•´ä¸º999999")):(s.value.quantity=Math.floor(t).toString(),n("è¿›è´§æ•°é‡å¿…é¡»ä¸ºæ•´æ•°"))},S=()=>{const t=parseFloat(s.value.costPrice);isNaN(t)||t<0?(s.value.costPrice="0",n("è¿›è´§å•ä»·ä¸èƒ½ä¸ºè´Ÿæ•°")):t<.01&&t!==0?(s.value.costPrice="0.01",n("è¿›è´§å•ä»·è¿‡å°ï¼Œå·²è°ƒæ•´ä¸º0.01å…ƒ")):t>999999&&(s.value.costPrice="999999",n("è¿›è´§å•ä»·è¿‡å¤§ï¼Œå·²è°ƒæ•´ä¸º999999å…ƒ"))},B=()=>{if(!s.value.productId){n({type:"fail",message:"è¯·é€‰æ‹©å•†å“"});return}const t=parseInt(s.value.quantity),e=parseFloat(s.value.costPrice);if(isNaN(t)||t<=0){n("è¯·è¾“å…¥æœ‰æ•ˆçš„è¿›è´§æ•°é‡ï¼ˆå¿…é¡»å¤§äº0ï¼‰");return}if(!Number.isInteger(t)){n("è¿›è´§æ•°é‡å¿…é¡»ä¸ºæ•´æ•°");return}if(isNaN(e)||e<=0){n("è¯·è¾“å…¥æœ‰æ•ˆçš„è¿›è´§å•ä»·ï¼ˆå¿…é¡»å¤§äº0ï¼‰");return}if(e>999999){n("è¿›è´§å•ä»·è¿‡å¤§ï¼Œè¯·æ£€æŸ¥è¾“å…¥");return}const N={productId:s.value.productId,quantity:t,costPrice:e,supplier:s.value.supplier},i=m.addPurchase(N);i.success?(n({type:"success",message:"è¿›è´§æˆåŠŸ"}),s.value={productId:"",quantity:"",costPrice:"",supplier:""},f.value="",c.value=null):n({type:"fail",message:i.message})},D=t=>k(this,null,function*(){try{yield W({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤è¿™æ¡è¿›è´§è®°å½•å—ï¼Ÿ

å•†å“ï¼š${t.productName}
æ•°é‡ï¼š${t.quantity}ä»¶
é‡‘é¢ï¼šÂ¥${t.totalAmount.toFixed(2)}

åˆ é™¤åå°†å‡å°‘å¯¹åº”çš„åº“å­˜ã€‚`,confirmButtonText:"ç¡®è®¤åˆ é™¤",confirmButtonColor:"#ee0a24"}),(yield m.deletePurchase(t.id))?n({type:"success",message:"å·²åˆ é™¤è¿›è´§è®°å½•"}):n({type:"fail",message:"åˆ é™¤å¤±è´¥"})}catch(e){}}),U=t=>{const e=new Date(t);return`${e.getMonth()+1}æœˆ${e.getDate()}æ—¥ ${e.getHours()}:${String(e.getMinutes()).padStart(2,"0")}`};return(t,e)=>{const N=v("van-nav-bar"),i=v("van-field"),A=v("van-button"),M=v("van-form"),T=v("van-icon"),h=v("van-picker"),z=v("van-popup");return b(),P("div",X,[l(N,{title:"è¿›è´§ç®¡ç†","left-arrow":"",onClickLeft:e[0]||(e[0]=o=>V(q).back())}),a("div",Y,[a("div",Z,[e[13]||(e[13]=a("div",{class:"section-title"},"ğŸ“¦ å•†å“è¿›è´§",-1)),l(M,{onSubmit:B},{default:y(()=>[l(i,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=o=>f.value=o),name:"product",label:"é€‰æ‹©å•†å“",placeholder:"è¯·é€‰æ‹©å•†å“",readonly:"","is-link":"",onClick:e[2]||(e[2]=o=>r.value=!0),rules:[{required:!0,message:"è¯·é€‰æ‹©å•†å“"}]},null,8,["modelValue"]),l(i,{modelValue:s.value.quantity,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.quantity=o),name:"quantity",type:"number",label:"è¿›è´§æ•°é‡",placeholder:"è¯·è¾“å…¥è¿›è´§æ•°é‡",rules:[{required:!0,message:"è¯·è¾“å…¥è¿›è´§æ•°é‡"},{validator:$,message:"æ•°é‡å¿…é¡»ä¸ºæ­£æ•´æ•°"}],onBlur:F},{button:y(()=>[...e[9]||(e[9]=[a("span",null,"ä»¶",-1)])]),_:1},8,["modelValue","rules"]),l(i,{modelValue:s.value.costPrice,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.costPrice=o),name:"costPrice",type:"number",label:"è¿›è´§å•ä»·",placeholder:"è¯·è¾“å…¥è¿›è´§å•ä»·",rules:[{required:!0,message:"è¯·è¾“å…¥è¿›è´§å•ä»·"},{validator:C,message:"å•ä»·å¿…é¡»å¤§äº0"}],onBlur:S},{button:y(()=>[...e[10]||(e[10]=[a("span",null,"å…ƒ",-1)])]),_:1},8,["modelValue","rules"]),l(i,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=o=>p.value=o),name:"totalAmount",label:"è¿›è´§æ€»é¢",readonly:"",value:p.value},{button:y(()=>[...e[11]||(e[11]=[a("span",null,"å…ƒ",-1)])]),_:1},8,["modelValue","value"]),l(i,{modelValue:s.value.supplier,"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.supplier=o),name:"supplier",label:"ä¾›åº”å•†",placeholder:"è¯·è¾“å…¥ä¾›åº”å•†åç§°"},null,8,["modelValue"]),a("div",O,[l(A,{round:"",block:"",type:"success","native-type":"submit",size:"large"},{default:y(()=>[...e[12]||(e[12]=[Q(" ç¡®è®¤è¿›è´§ ",-1)])]),_:1})])]),_:1})]),a("div",ee,[e[15]||(e[15]=a("div",{class:"section-title"},"ğŸ“‹ è¿›è´§è®°å½•",-1)),V(m).purchases.length===0?(b(),P("div",te,[...e[14]||(e[14]=[a("div",{class:"empty-state-icon"},"ğŸ“¦",-1),a("div",{class:"empty-state-text"},"æš‚æ— è¿›è´§è®°å½•",-1)])])):R("",!0),(b(!0),P(G,null,J(V(m).purchases,o=>(b(),P("div",{key:o.id,class:"record-item"},[a("div",se,[a("div",oe,_(o.productName),1),a("div",ae,[a("div",ne,"Â¥"+_(o.totalAmount.toFixed(2)),1),l(T,{name:"delete-o",class:"delete-btn",onClick:K(ce=>D(o),["stop"])},null,8,["onClick"])])]),a("div",le,[a("span",null,"æ•°é‡: "+_(o.quantity)+"ä»¶",1),a("span",null,"å•ä»·: Â¥"+_(o.costPrice),1)]),a("div",ue,[a("span",re,_(o.supplier),1),a("span",ie,_(U(o.date)),1)])]))),128))])]),l(z,{show:r.value,"onUpdate:show":e[8]||(e[8]=o=>r.value=o),position:"bottom"},{default:y(()=>[l(h,{columns:u.value,onConfirm:x,onCancel:e[7]||(e[7]=o=>r.value=!1)},null,8,["columns"])]),_:1},8,["show"])])}}},me=L(de,[["__scopeId","data-v-a4f1c06b"]]);export{me as default};
