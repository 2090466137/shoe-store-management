var E=(F,N,h)=>new Promise((v,m)=>{var i=u=>{try{d(h.next(u))}catch(k){m(k)}},f=u=>{try{d(h.throw(u))}catch(k){m(k)}},d=u=>u.done?v(u.value):Promise.resolve(u.value).then(i,f);d((h=h.apply(F,N)).next())});import{_ as ce,i as ie,r,k as V,o as ue,c as n,d as c,b as s,w as p,m as B,l as re,a as de,e as _,n as $,t as o,f as H,F as K,p as Y,g as l,v as j,x as ve,s as C,q as ke}from"./index-Dd-o1vNh.js";import{s as pe}from"./search-CbM0cuqP.js";const _e={class:"inventory-page page-container"},he={class:"content-wrapper"},me={key:0,class:"status-card card"},fe={class:"status-header"},ye={class:"status-time"},ge={class:"status-stats"},Se={class:"status-item"},Ce={class:"status-value"},be={class:"status-item"},we={class:"status-value error"},Ie={key:1,class:"quick-actions card"},Ve={key:2,class:"check-list"},$e={class:"search-wrapper"},De={class:"filter-tabs"},Te={class:"product-list"},xe=["onClick"],ze={class:"item-image"},He=["src","alt"],Ne={key:0,class:"check-status"},Ue={class:"item-info"},qe={class:"item-name"},Be={class:"item-spec"},Fe={class:"item-stocks"},Me={class:"system-stock"},Pe={key:1,class:"unchecked-tag"},Je={class:"item-action"},Le={key:1,class:"difference-badge"},Oe={key:0,class:"plus"},Re={key:1,class:"minus"},Ae={key:2,class:"equal"},Ee={key:3,class:"result-section"},Ke={class:"result-card card"},Ye={class:"result-summary"},je={class:"result-item"},Ge={class:"result-value"},Qe={class:"result-item"},We={class:"result-value success"},Xe={class:"result-item"},Ze={class:"result-value error"},et={class:"check-dialog-content"},tt={class:"dialog-product-info"},st={class:"dialog-product-name"},at={class:"dialog-product-spec"},ot={class:"history-popup"},lt={class:"history-header"},nt={class:"history-list"},ct=["onClick"],it={class:"history-info"},ut={class:"history-date"},rt={class:"history-meta"},dt={__name:"Inventory",setup(F){const N=de(),h=ie(),v=r(!1),m=r(null),i=r([]),f=r(""),d=r("all"),u=r(!1),k=r(null),y=r(""),b=r(""),D=r(!1),T=r([]),g=V(()=>i.value.length),w=V(()=>i.value.filter(a=>a.checked).length),U=V(()=>i.value.filter(a=>a.checked&&a.actualStock!==a.systemStock).length),M=V(()=>i.value.filter(a=>a.checked&&a.actualStock===a.systemStock).length),G=V(()=>{let a=i.value;return f.value&&(a=pe(a,f.value)),d.value==="unchecked"?a=a.filter(e=>!e.checked):d.value==="difference"?a=a.filter(e=>e.checked&&e.actualStock!==e.systemStock):d.value==="checked"&&(a=a.filter(e=>e.checked)),a}),P=()=>{const a=h.getAllProducts;if(a.length===0){C("æš‚æ— å•†å“ï¼Œæ— æ³•è¿›è¡Œç›˜ç‚¹");return}v.value=!0,m.value={id:Date.now().toString(),startTime:Date.now(),endTime:null},i.value=a.map(e=>({productId:e.id,name:e.name,code:e.code,size:e.size,color:e.color,image:e.image,systemStock:e.stock,actualStock:null,checked:!1,remark:""})),C("ç›˜ç‚¹å·²å¼€å§‹")},J=a=>{k.value=a,y.value=a.checked?a.actualStock.toString():"",b.value=a.remark||"",u.value=!0},Q=()=>{if(!y.value&&y.value!=="0"){C("è¯·è¾“å…¥å®é™…åº“å­˜");return}const a=parseInt(y.value),e=i.value.find(S=>S.productId===k.value.productId);e&&(e.actualStock=a,e.checked=!0,e.remark=b.value),C("ç›˜ç‚¹æˆåŠŸ"),y.value="",b.value=""},L=()=>E(this,null,function*(){if(w.value<g.value&&!(yield ke({title:"æç¤º",message:`è¿˜æœ‰ ${g.value-w.value} ç§å•†å“æœªç›˜ç‚¹ï¼Œç¡®å®šè¦å®Œæˆç›˜ç‚¹å—ï¼Ÿ`}).catch(()=>!1)))return;for(const e of i.value)e.checked&&(yield h.updateProduct(e.productId,{stock:e.actualStock}));const a={id:m.value.id,startTime:m.value.startTime,endTime:Date.now(),totalCount:g.value,checkedCount:w.value,differenceCount:U.value,matchCount:M.value,items:i.value.filter(e=>e.checked)};T.value.unshift(a),te(),C({type:"success",message:"ç›˜ç‚¹å®Œæˆï¼Œåº“å­˜å·²æ›´æ–°"}),v.value=!1,m.value=null,i.value=[],d.value="all",f.value=""}),W=a=>{C("å†å²è¯¦æƒ…åŠŸèƒ½å¾…å¼€å‘")},X=()=>{},Z=()=>{},O=a=>{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},ee=()=>{const a=localStorage.getItem("inventoryHistory");a&&(T.value=JSON.parse(a))},te=()=>{localStorage.setItem("inventoryHistory",JSON.stringify(T.value))};return ue(()=>{h.loadProducts(),ee()}),(a,e)=>{const S=_("van-icon"),se=_("van-nav-bar"),x=_("van-button"),ae=_("van-search"),z=_("van-tab"),oe=_("van-tabs"),R=_("van-field"),le=_("van-dialog"),ne=_("van-popup");return l(),n("div",_e,[c(se,{title:"åº“å­˜ç›˜ç‚¹","left-arrow":"",onClickLeft:e[0]||(e[0]=t=>re(N).back())},{right:p(()=>[v.value?(l(),B(S,{key:1,name:"success",onClick:L})):(l(),B(S,{key:0,name:"add-o",onClick:P}))]),_:1}),s("div",he,[v.value?(l(),n("div",me,[s("div",fe,[e[9]||(e[9]=s("span",{class:"status-badge checking"},"ç›˜ç‚¹ä¸­",-1)),s("span",ye,o(O(m.value.startTime)),1)]),s("div",ge,[s("div",Se,[e[10]||(e[10]=s("span",{class:"status-label"},"å·²ç›˜ç‚¹",-1)),s("span",Ce,o(w.value)+"/"+o(g.value),1)]),s("div",be,[e[11]||(e[11]=s("span",{class:"status-label"},"å·®å¼‚æ•°",-1)),s("span",we,o(U.value),1)])])])):$("",!0),v.value?$("",!0):(l(),n("div",Ie,[c(x,{type:"primary",size:"large",block:"",icon:"plus",onClick:P},{default:p(()=>[...e[12]||(e[12]=[H(" å¼€å§‹æ–°ç›˜ç‚¹ ",-1)])]),_:1}),c(x,{type:"default",size:"large",block:"",icon:"records",onClick:e[1]||(e[1]=t=>D.value=!0),style:{"margin-top":"12px"}},{default:p(()=>[...e[13]||(e[13]=[H(" æŸ¥çœ‹å†å²è®°å½• ",-1)])]),_:1})])),v.value?(l(),n("div",Ve,[s("div",$e,[c(ae,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=t=>f.value=t),placeholder:"æœç´¢å•†å“",onSearch:X},null,8,["modelValue"])]),s("div",De,[c(oe,{active:d.value,"onUpdate:active":e[3]||(e[3]=t=>d.value=t),onChange:Z},{default:p(()=>[c(z,{title:"å…¨éƒ¨",name:"all"}),c(z,{title:"æœªç›˜ç‚¹",name:"unchecked"}),c(z,{title:"æœ‰å·®å¼‚",name:"difference"}),c(z,{title:"å·²å®Œæˆ",name:"checked"})]),_:1},8,["active"])]),s("div",Te,[(l(!0),n(K,null,Y(G.value,t=>(l(),n("div",{key:t.productId,class:j(["check-item",{"has-difference":t.checked&&t.actualStock!==t.systemStock,checked:t.checked}]),onClick:I=>J(t)},[s("div",ze,[s("img",{src:t.image||"https://via.placeholder.com/60",alt:t.name},null,8,He),t.checked?(l(),n("div",Ne,[c(S,{name:"success",color:"#07c160"})])):$("",!0)]),s("div",Ue,[s("div",qe,o(t.name),1),s("div",Be,"è´§å·: "+o(t.code)+" | "+o(t.size)+"ç  | "+o(t.color),1),s("div",Fe,[s("span",Me,"ç³»ç»Ÿ: "+o(t.systemStock),1),t.checked?(l(),n("span",{key:0,class:j(["actual-stock",{difference:t.actualStock!==t.systemStock}])}," å®é™…: "+o(t.actualStock),3)):(l(),n("span",Pe,"æœªç›˜ç‚¹"))])]),s("div",Je,[t.checked?(l(),n("div",Le,[t.actualStock>t.systemStock?(l(),n("span",Oe," +"+o(t.actualStock-t.systemStock),1)):t.actualStock<t.systemStock?(l(),n("span",Re,o(t.actualStock-t.systemStock),1)):(l(),n("span",Ae,"âœ“"))])):(l(),B(x,{key:0,type:"primary",size:"small",onClick:ve(I=>J(t),["stop"])},{default:p(()=>[...e[14]||(e[14]=[H(" ç›˜ç‚¹ ",-1)])]),_:1},8,["onClick"]))])],10,xe))),128))])])):$("",!0),v.value&&w.value===g.value?(l(),n("div",Ee,[s("div",Ke,[e[19]||(e[19]=s("div",{class:"result-title"},"ğŸ“‹ ç›˜ç‚¹å®Œæˆ",-1)),s("div",Ye,[s("div",je,[e[15]||(e[15]=s("span",{class:"result-label"},"ç›˜ç‚¹å•†å“",-1)),s("span",Ge,o(g.value)+" ç§",1)]),s("div",Qe,[e[16]||(e[16]=s("span",{class:"result-label"},"åº“å­˜ä¸€è‡´",-1)),s("span",We,o(M.value)+" ç§",1)]),s("div",Xe,[e[17]||(e[17]=s("span",{class:"result-label"},"åº“å­˜å·®å¼‚",-1)),s("span",Ze,o(U.value)+" ç§",1)])]),c(x,{type:"primary",size:"large",block:"",onClick:L},{default:p(()=>[...e[18]||(e[18]=[H(" å®Œæˆç›˜ç‚¹å¹¶æ›´æ–°åº“å­˜ ",-1)])]),_:1})])])):$("",!0)]),c(le,{show:u.value,"onUpdate:show":e[6]||(e[6]=t=>u.value=t),title:"ç›˜ç‚¹å•†å“","show-cancel-button":"",onConfirm:Q},{default:p(()=>{var t,I,A;return[s("div",et,[s("div",tt,[s("div",st,o((t=k.value)==null?void 0:t.name),1),s("div",at,o((I=k.value)==null?void 0:I.brand)+" | "+o((A=k.value)==null?void 0:A.size)+"ç  ",1)]),c(R,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=q=>y.value=q),type:"number",label:"å®é™…åº“å­˜",placeholder:"è¯·è¾“å…¥å®é™…åº“å­˜æ•°é‡",rules:[{required:!0,message:"è¯·è¾“å…¥å®é™…åº“å­˜"}]},{button:p(()=>[...e[20]||(e[20]=[s("span",null,"ä»¶",-1)])]),_:1},8,["modelValue"]),c(R,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=q=>b.value=q),type:"textarea",label:"å¤‡æ³¨",placeholder:"å¦‚æœ‰å·®å¼‚ï¼Œè¯·è¯´æ˜åŸå› ï¼ˆé€‰å¡«ï¼‰",rows:"2",maxlength:"100","show-word-limit":""},null,8,["modelValue"])])]}),_:1},8,["show"]),c(ne,{show:D.value,"onUpdate:show":e[8]||(e[8]=t=>D.value=t),position:"bottom",style:{height:"80%"}},{default:p(()=>[s("div",ot,[s("div",lt,[e[21]||(e[21]=s("span",{class:"history-title"},"ç›˜ç‚¹å†å²",-1)),c(S,{name:"cross",onClick:e[7]||(e[7]=t=>D.value=!1)})]),s("div",nt,[(l(!0),n(K,null,Y(T.value,t=>(l(),n("div",{key:t.id,class:"history-item",onClick:I=>W(t)},[s("div",it,[s("div",ut,o(O(t.startTime)),1),s("div",rt,o(t.totalCount)+"ç§å•†å“ | "+o(t.differenceCount)+"å¤„å·®å¼‚ ",1)]),e[22]||(e[22]=s("div",{class:"history-status"},[s("span",{class:"status-badge completed"},"å·²å®Œæˆ")],-1))],8,ct))),128))])])]),_:1},8,["show"])])}}},_t=ce(dt,[["__scopeId","data-v-9c77980d"]]);export{_t as default};
