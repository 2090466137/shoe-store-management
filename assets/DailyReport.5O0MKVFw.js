import{_ as L,j as U,i as V,r as $,k as A,o as M,c as d,d as v,b as t,w as q,e as C,l as I,a as H,n as x,t as l,F as w,p as D,s as J,g as r,v as Y}from"./index.CtZro4Eu.js";const G={class:"daily-report-page page-container"},K={class:"content-wrapper"},Q={class:"date-selector card"},W={class:"summary-section card"},X={class:"summary-grid"},Z={class:"summary-item"},tt={class:"summary-value primary"},st={class:"summary-item"},et={class:"summary-value"},ot={class:"summary-item"},at={class:"summary-value success"},nt={class:"summary-item"},lt={class:"summary-value"},it={class:"stats-section card"},dt={key:0,class:"staff-section card"},rt={class:"staff-list"},ut={class:"staff-rank"},ct={class:"staff-info"},vt={class:"staff-name"},mt={class:"staff-meta"},pt={class:"staff-amount"},_t={class:"staff-sales"},ft={class:"staff-profit"},yt={key:1,class:"hot-products-section card"},ht={class:"hot-list"},gt={class:"hot-image"},Ct=["src","alt"],St={class:"hot-info"},kt={class:"hot-name"},Pt={class:"hot-meta"},xt={class:"hot-stats"},wt={class:"hot-quantity"},Dt={class:"hot-amount"},bt={key:2,class:"details-section card"},qt={class:"order-list"},It={class:"order-header"},Ft={class:"order-time"},$t={class:"order-salesperson"},At={class:"order-products"},Rt={class:"product-name"},Ot={class:"product-quantity"},jt={class:"product-price"},zt={class:"order-footer"},Nt={class:"order-total"},Tt={class:"order-profit"},Bt={key:3,class:"empty-state"},Et={class:"popup-header"},Lt={__name:"DailyReport",setup(Ut){const R=H(),F=U(),b=V(),y=$(!1),S=$([new Date().getFullYear(),new Date().getMonth()+1,new Date().getDate()]),O=new Date(2024,0,1),j=new Date,k=A(()=>`${S.value[0]}-${String(S.value[1]).padStart(2,"0")}-${String(S.value[2]).padStart(2,"0")}`),n=A(()=>{const p=k.value,s=new Date(p).setHours(0,0,0,0),h=new Date(p).setHours(23,59,59,999),u=F.getAllSales.filter(o=>{const a=o.time||o.date;return a>=s&&a<=h});if(u.length===0)return{totalSales:0,totalCost:0,totalProfit:0,profitRate:0,orderCount:0,productCount:0,avgOrderAmount:0,avgProductPrice:0,staffStats:[],hotProducts:[],orders:[]};let i=0,P=0,g=0,_=0;u.forEach(o=>{i+=o.totalAmount,g+=o.profit,o.products&&Array.isArray(o.products)?_+=o.products.reduce((a,f)=>a+f.quantity,0):_+=o.quantity||0}),P=i-g;const e={};u.forEach(o=>{const a=o.salesperson||"æœªæŒ‡å®š";e[a]||(e[a]={name:a,orderCount:0,productCount:0,sales:0,profit:0}),e[a].orderCount++,o.products&&Array.isArray(o.products)?e[a].productCount+=o.products.reduce((f,E)=>f+E.quantity,0):e[a].productCount+=o.quantity||0,e[a].sales+=o.totalAmount,e[a].profit+=o.profit});const c=Object.values(e).sort((o,a)=>a.sales-o.sales),m={};u.forEach(o=>{if(o.products&&Array.isArray(o.products))o.products.forEach(a=>{if(!m[a.productId]){const f=b.getProductById(a.productId);m[a.productId]={id:a.productId,name:a.productName,code:a.code,size:a.size,color:a.color,image:(f==null?void 0:f.image)||"",quantity:0,amount:0}}m[a.productId].quantity+=a.quantity,m[a.productId].amount+=a.salePrice*a.quantity});else if(o.productId){if(!m[o.productId]){const a=b.getProductById(o.productId);m[o.productId]={id:o.productId,name:o.productName,brand:o.brand||"",size:o.size||"",image:(a==null?void 0:a.image)||"",quantity:0,amount:0}}m[o.productId].quantity+=o.quantity,m[o.productId].amount+=o.totalAmount}});const B=Object.values(m).sort((o,a)=>a.quantity-o.quantity).slice(0,5);return{totalSales:i,totalCost:P,totalProfit:g,profitRate:i>0?(g/i*100).toFixed(1):0,orderCount:u.length,productCount:_,avgOrderAmount:i/u.length,avgProductPrice:_>0?i/_:0,staffStats:c,hotProducts:B,orders:u.sort((o,a)=>a.time-o.time)}}),z=()=>{y.value=!1},N=p=>{const s=new Date(p);return`${String(s.getHours()).padStart(2,"0")}:${String(s.getMinutes()).padStart(2,"0")}`},T=()=>{const p={date:k.value,summary:{totalSales:n.value.totalSales,totalCost:n.value.totalCost,totalProfit:n.value.totalProfit,profitRate:n.value.profitRate,orderCount:n.value.orderCount,productCount:n.value.productCount},staffStats:n.value.staffStats,hotProducts:n.value.hotProducts,orders:n.value.orders},s=JSON.stringify(p,null,2),h=new Blob([s],{type:"application/json"}),u=URL.createObjectURL(h),i=document.createElement("a");i.href=u,i.download=`è¥ä¸šæŠ¥è¡¨_${k.value}.json`,i.click(),URL.revokeObjectURL(u),J({type:"success",message:"æŠ¥è¡¨å·²å¯¼å‡º"})};return M(()=>{F.loadSales(),b.loadProducts()}),(p,s)=>{const h=C("van-icon"),u=C("van-nav-bar"),i=C("van-cell"),P=C("van-cell-group"),g=C("van-date-picker"),_=C("van-popup");return r(),d("div",G,[v(u,{title:"æ¯æ—¥è¥ä¸šæŠ¥è¡¨","left-arrow":"",onClickLeft:s[0]||(s[0]=e=>I(R).back())},{right:q(()=>[v(h,{name:"share-o",size:"22",onClick:T})]),_:1}),t("div",K,[t("div",Q,[v(i,{title:"é€‰æ‹©æ—¥æœŸ",value:k.value,"is-link":"",onClick:s[1]||(s[1]=e=>y.value=!0)},null,8,["value"])]),t("div",W,[s[10]||(s[10]=t("div",{class:"section-title"},"ðŸ“Š è¥ä¸šæ¦‚å†µ",-1)),t("div",X,[t("div",Z,[s[6]||(s[6]=t("div",{class:"summary-label"},"é”€å”®é¢",-1)),t("div",tt,"Â¥"+l(n.value.totalSales.toFixed(2)),1)]),t("div",st,[s[7]||(s[7]=t("div",{class:"summary-label"},"æˆæœ¬",-1)),t("div",et,"Â¥"+l(n.value.totalCost.toFixed(2)),1)]),t("div",ot,[s[8]||(s[8]=t("div",{class:"summary-label"},"åˆ©æ¶¦",-1)),t("div",at,"Â¥"+l(n.value.totalProfit.toFixed(2)),1)]),t("div",nt,[s[9]||(s[9]=t("div",{class:"summary-label"},"åˆ©æ¶¦çŽ‡",-1)),t("div",lt,l(n.value.profitRate)+"%",1)])])]),t("div",it,[s[11]||(s[11]=t("div",{class:"section-title"},"ðŸ›’ é”€å”®ç»Ÿè®¡",-1)),v(P,{inset:""},{default:q(()=>[v(i,{title:"è®¢å•æ•°é‡",value:`${n.value.orderCount} å•`},null,8,["value"]),v(i,{title:"å•†å“æ•°é‡",value:`${n.value.productCount} ä»¶`},null,8,["value"]),v(i,{title:"å®¢å•ä»·",value:`Â¥${n.value.avgOrderAmount.toFixed(2)}`},null,8,["value"]),v(i,{title:"ä»¶å•ä»·",value:`Â¥${n.value.avgProductPrice.toFixed(2)}`},null,8,["value"])]),_:1})]),n.value.staffStats.length>0?(r(),d("div",dt,[s[12]||(s[12]=t("div",{class:"section-title"},"ðŸ‘¥ é”€å”®å‘˜ä¸šç»©",-1)),t("div",rt,[(r(!0),d(w,null,D(n.value.staffStats,(e,c)=>(r(),d("div",{key:e.name,class:"staff-item"},[t("div",ut,l(c+1),1),t("div",ct,[t("div",vt,l(e.name),1),t("div",mt,l(e.orderCount)+"å• | "+l(e.productCount)+"ä»¶ ",1)]),t("div",pt,[t("div",_t,"Â¥"+l(e.sales.toFixed(2)),1),t("div",ft,"åˆ©æ¶¦ Â¥"+l(e.profit.toFixed(2)),1)])]))),128))])])):x("",!0),n.value.hotProducts.length>0?(r(),d("div",yt,[s[13]||(s[13]=t("div",{class:"section-title"},"ðŸ”¥ çƒ­é”€å•†å“ TOP5",-1)),t("div",ht,[(r(!0),d(w,null,D(n.value.hotProducts,(e,c)=>(r(),d("div",{key:e.id,class:"hot-item"},[t("div",{class:Y(["hot-rank",`rank-${c+1}`])},l(c+1),3),t("div",gt,[t("img",{src:e.image||"https://via.placeholder.com/50",alt:e.name},null,8,Ct)]),t("div",St,[t("div",kt,l(e.name),1),t("div",Pt,"è´§å·: "+l(e.code)+" | "+l(e.size)+"ç  | "+l(e.color),1)]),t("div",xt,[t("div",wt,"é”€é‡: "+l(e.quantity),1),t("div",Dt,"Â¥"+l(e.amount.toFixed(2)),1)])]))),128))])])):x("",!0),n.value.orders.length>0?(r(),d("div",bt,[s[14]||(s[14]=t("div",{class:"section-title"},"ðŸ“ é”€å”®æ˜Žç»†",-1)),t("div",qt,[(r(!0),d(w,null,D(n.value.orders,e=>(r(),d("div",{key:e.id,class:"order-item"},[t("div",It,[t("span",Ft,l(N(e.time)),1),t("span",$t,l(e.salesperson),1)]),t("div",At,[(r(!0),d(w,null,D(e.products,c=>(r(),d("div",{key:c.productId,class:"order-product"},[t("span",Rt,l(c.productName),1),t("span",Ot,"Ã—"+l(c.quantity),1),t("span",jt,"Â¥"+l(c.salePrice.toFixed(2)),1)]))),128))]),t("div",zt,[t("span",Nt,"åˆè®¡: Â¥"+l(e.totalAmount.toFixed(2)),1),t("span",Tt,"åˆ©æ¶¦: Â¥"+l(e.profit.toFixed(2)),1)])]))),128))])])):x("",!0),n.value.orderCount===0?(r(),d("div",Bt,[...s[15]||(s[15]=[t("div",{class:"empty-icon"},"ðŸ“­",-1),t("div",{class:"empty-text"},"å½“å¤©æš‚æ— é”€å”®è®°å½•",-1)])])):x("",!0)]),v(_,{show:y.value,"onUpdate:show":s[5]||(s[5]=e=>y.value=e),position:"bottom",round:""},{default:q(()=>[t("div",Et,[s[16]||(s[16]=t("span",null,null,-1)),s[17]||(s[17]=t("span",{class:"popup-title"},"é€‰æ‹©æ—¥æœŸ",-1)),v(h,{name:"cross",class:"popup-close",onClick:s[2]||(s[2]=e=>y.value=!1)})]),v(g,{modelValue:S.value,"onUpdate:modelValue":s[3]||(s[3]=e=>S.value=e),"min-date":I(O),"max-date":I(j),onConfirm:z,onCancel:s[4]||(s[4]=e=>y.value=!1)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"])])}}},Mt=L(Lt,[["__scopeId","data-v-e35883aa"]]);export{Mt as default};
