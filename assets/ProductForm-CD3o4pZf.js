var O=Object.defineProperty,h=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var q=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var $=(m,r,d)=>r in m?O(m,r,{enumerable:!0,configurable:!0,writable:!0,value:d}):m[r]=d,A=(m,r)=>{for(var d in r||(r={}))oe.call(r,d)&&$(m,d,r[d]);if(q)for(var d of q(r))le.call(r,d)&&$(m,d,r[d]);return m},R=(m,r)=>h(m,ee(r));import{_ as ae,i as te,r as b,k as w,o as se,y as ne,c as re,d as t,b as n,l as ue,a as ie,e as p,w as u,f as x,t as de,s,g as me}from"./index-Dd-o1vNh.js";const pe={class:"product-form-page page-container"},ve={class:"content-wrapper"},ce={class:"upload-placeholder"},fe={class:"form-actions"},ge={class:"popup-header"},ke={class:"popup-header"},be={__name:"ProductForm",setup(m){const r=ie(),d=ne(),y=te(),V=b(!1),c=b(!1),k=b(!1),P=b([]),f=b(""),D=["高跟鞋","平底鞋","运动鞋","休闲鞋","凉鞋","拖鞋","靴子","单鞋","帆布鞋","板鞋","厚底鞋","其他"],L=w(()=>{const l=new Set;return y.getAllProducts.forEach(e=>{e.category&&e.category.trim()&&l.add(e.category)}),Array.from(l).sort()}),M=w(()=>{const l=new Set([...D,...L.value]);return Array.from(l).sort()}),_=["30","31","32","33","34","35","36","37","38","39","40","41","42"],o=b({code:"",color:"",size:"",category:"",costPrice:"",salePrice:"",stock:"",minStock:"5",supplier:"",image:""}),S=w(()=>{const l=[];return o.value.code&&l.push(o.value.code),o.value.color&&l.push(o.value.color),o.value.size&&l.push(o.value.size+"码"),l.length>0?l.join("-"):"（自动生成）"});se(()=>{const l=d.params.id;if(l){V.value=!0;const e=y.getProductById(l);e&&(o.value={code:e.code||e.brand||"",color:e.color||"",size:e.size||"",category:e.category||"",costPrice:e.costPrice.toString(),salePrice:e.salePrice.toString(),stock:e.stock.toString(),minStock:e.minStock.toString(),supplier:e.supplier||"",image:e.image||""},e.image&&(P.value=[{url:e.image,isImage:!0}]))}});const E=l=>{const e=new FileReader;e.onload=v=>{o.value.image=v.target.result,P.value=[{url:v.target.result,isImage:!0}]},e.readAsDataURL(l.file)},T=()=>(o.value.image="",!0),j=()=>{f.value&&f.value.trim()?(o.value.category=f.value.trim(),c.value=!1,f.value="",s("已使用自定义分类")):s("请输入分类名称")},Y=({selectedOptions:l})=>{o.value.category=l[0].text||l[0],c.value=!1,f.value=""},G=({selectedOptions:l})=>{o.value.size=l[0].text||l[0],k.value=!1},z=l=>{const e=parseFloat(l);return!isNaN(e)&&e>0},U=l=>{const e=parseInt(l);return!isNaN(e)&&e>=0&&Number.isInteger(parseFloat(l))},H=()=>{const l=parseFloat(o.value.costPrice);isNaN(l)||l<0?(o.value.costPrice="0",s("成本价不能为负数")):l<.01&&l!==0?(o.value.costPrice="0.01",s("成本价过小，已调整为0.01元")):l>999999&&(o.value.costPrice="999999",s("成本价过大，已调整为999999元"))},J=()=>{const l=parseFloat(o.value.salePrice);isNaN(l)||l<0?(o.value.salePrice="0",s("销售价不能为负数")):l<.01&&l!==0?(o.value.salePrice="0.01",s("销售价过小，已调整为0.01元")):l>999999&&(o.value.salePrice="999999",s("销售价过大，已调整为999999元"))},K=()=>{const l=parseInt(o.value.stock);isNaN(l)||l<0?(o.value.stock="0",s("库存不能为负数")):Number.isInteger(parseFloat(o.value.stock))?l>9999999&&(o.value.stock="9999999",s("库存数量过大")):(o.value.stock=Math.floor(l).toString(),s("库存必须为整数"))},Q=()=>{const l=parseInt(o.value.minStock);isNaN(l)||l<0?(o.value.minStock="0",s("最低库存不能为负数")):Number.isInteger(parseFloat(o.value.minStock))?l>9999&&(o.value.minStock="9999",s("最低库存预警值过大")):(o.value.minStock=Math.floor(l).toString(),s("最低库存必须为整数"))},W=()=>{const l=parseFloat(o.value.costPrice),e=parseFloat(o.value.salePrice),v=parseInt(o.value.stock),g=parseInt(o.value.minStock);if(isNaN(l)||l<0){s("请输入有效的成本价");return}if(isNaN(e)||e<0){s("请输入有效的销售价");return}if(isNaN(v)||v<0){s("请输入有效的库存数量");return}if(isNaN(g)||g<0){s("请输入有效的最低库存");return}const C=S.value==="（自动生成）"?"未命名商品":S.value,i=o.value.code||"无品牌",N=R(A({},o.value),{name:C,brand:i,costPrice:l,salePrice:e,stock:v,minStock:g});V.value?(y.updateProduct(d.params.id,N),s({type:"success",message:"修改成功"})):(y.addProduct(N),s({type:"success",message:"添加成功"})),r.back()};return(l,e)=>{const v=p("van-nav-bar"),g=p("van-icon"),C=p("van-uploader"),i=p("van-field"),N=p("van-cell-group"),I=p("van-button"),X=p("van-form"),Z=p("van-divider"),F=p("van-picker"),B=p("van-popup");return me(),re("div",pe,[t(v,{title:V.value?"编辑商品":"添加商品","left-arrow":"",onClickLeft:e[0]||(e[0]=a=>ue(r).back())},null,8,["title"]),n("div",ve,[t(X,{onSubmit:W},{default:u(()=>[t(N,{inset:""},{default:u(()=>[t(i,{name:"image",label:"商品图片"},{input:u(()=>[t(C,{modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=a=>P.value=a),"max-count":1,"after-read":E,"before-delete":T},{default:u(()=>[n("div",ce,[t(g,{name:"photograph",size:"40"}),e[21]||(e[21]=n("div",{class:"upload-text"},"点击上传图片",-1))])]),_:1},8,["modelValue"])]),_:1}),t(i,{modelValue:o.value.code,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.code=a),name:"code",label:"货号",placeholder:"例如：206731-2 或 AYL505610-1",rules:[{required:!0,message:"请输入货号"}]},{extra:u(()=>[...e[22]||(e[22]=[n("span",{class:"code-hint"},"支持字母数字组合",-1)])]),_:1},8,["modelValue"]),t(i,{modelValue:o.value.color,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.color=a),name:"color",label:"颜色",placeholder:"请输入颜色",rules:[{required:!0,message:"请输入颜色"}]},null,8,["modelValue"]),t(i,{modelValue:o.value.size,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.size=a),name:"size",label:"尺码",placeholder:"请选择尺码",readonly:"","is-link":"",onClick:e[5]||(e[5]=a=>k.value=!0),rules:[{required:!0,message:"请选择尺码"}]},null,8,["modelValue"]),t(i,{modelValue:o.value.category,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.category=a),name:"category",label:"分类",placeholder:"请输入或选择分类（可选）","is-link":"",onClick:e[7]||(e[7]=a=>c.value=!0)},{extra:u(()=>[...e[23]||(e[23]=[n("span",{style:{"font-size":"12px",color:"#969799"}},"可自定义",-1)])]),_:1},8,["modelValue"]),t(i,{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=a=>S.value=a),name:"displayName",label:"显示名称",placeholder:"自动生成",readonly:"",disabled:""},null,8,["modelValue"]),t(i,{modelValue:o.value.costPrice,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.costPrice=a),name:"costPrice",type:"number",label:"成本价",placeholder:"请输入成本价",rules:[{required:!0,message:"请输入成本价"},{validator:z,message:"成本价必须大于0"}],onBlur:H},{button:u(()=>[...e[24]||(e[24]=[n("span",null,"元",-1)])]),_:1},8,["modelValue","rules"]),t(i,{modelValue:o.value.salePrice,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.salePrice=a),name:"salePrice",type:"number",label:"销售价",placeholder:"请输入销售价",rules:[{required:!0,message:"请输入销售价"},{validator:z,message:"销售价必须大于0"}],onBlur:J},{button:u(()=>[...e[25]||(e[25]=[n("span",null,"元",-1)])]),_:1},8,["modelValue","rules"]),t(i,{modelValue:o.value.stock,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.stock=a),name:"stock",type:"number",label:"库存数量",placeholder:"请输入库存数量",rules:[{required:!0,message:"请输入库存数量"},{validator:U,message:"库存必须为非负整数"}],onBlur:K},{button:u(()=>[...e[26]||(e[26]=[n("span",null,"件",-1)])]),_:1},8,["modelValue","rules"]),t(i,{modelValue:o.value.minStock,"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.minStock=a),name:"minStock",type:"number",label:"最低库存",placeholder:"请输入最低库存预警值",rules:[{required:!0,message:"请输入最低库存"},{validator:U,message:"最低库存必须为非负整数"}],onBlur:Q},{button:u(()=>[...e[27]||(e[27]=[n("span",null,"件",-1)])]),_:1},8,["modelValue","rules"]),t(i,{modelValue:o.value.supplier,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.supplier=a),name:"supplier",label:"供应商",placeholder:"请输入供应商"},null,8,["modelValue"])]),_:1}),n("div",fe,[t(I,{round:"",block:"",type:"primary","native-type":"submit",size:"large"},{default:u(()=>[x(de(V.value?"保存修改":"添加商品"),1)]),_:1})])]),_:1})]),t(B,{show:c.value,"onUpdate:show":e[17]||(e[17]=a=>c.value=a),position:"bottom",round:""},{default:u(()=>[n("div",ge,[e[28]||(e[28]=n("span",null,null,-1)),e[29]||(e[29]=n("span",{class:"popup-title"},"选择或输入分类",-1)),t(g,{name:"cross",class:"popup-close",onClick:e[14]||(e[14]=a=>c.value=!1)})]),t(i,{modelValue:f.value,"onUpdate:modelValue":e[15]||(e[15]=a=>f.value=a),placeholder:"输入自定义分类",clearable:"",style:{"margin-bottom":"12px"}},null,8,["modelValue"]),t(I,{type:"primary",block:"",size:"small",style:{"margin-bottom":"16px"},onClick:j},{default:u(()=>[...e[30]||(e[30]=[x(" 使用自定义分类 ",-1)])]),_:1}),t(Z,{style:{margin:"12px 0"}},{default:u(()=>[...e[31]||(e[31]=[x("或选择常用分类",-1)])]),_:1}),t(F,{columns:M.value,onConfirm:Y,onCancel:e[16]||(e[16]=a=>c.value=!1)},null,8,["columns"])]),_:1},8,["show"]),t(B,{show:k.value,"onUpdate:show":e[20]||(e[20]=a=>k.value=a),position:"bottom",round:""},{default:u(()=>[n("div",ke,[e[32]||(e[32]=n("span",null,null,-1)),e[33]||(e[33]=n("span",{class:"popup-title"},"选择尺码",-1)),t(g,{name:"cross",class:"popup-close",onClick:e[18]||(e[18]=a=>k.value=!1)})]),t(F,{columns:_,onConfirm:G,onCancel:e[19]||(e[19]=a=>k.value=!1)})]),_:1},8,["show"])])}}},Pe=ae(be,[["__scopeId","data-v-7c64409d"]]);export{Pe as default};
