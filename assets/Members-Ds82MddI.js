var E=(B,v,l)=>new Promise((d,c)=>{var w=o=>{try{f(l.next(o))}catch(u){c(u)}},C=o=>{try{f(l.throw(o))}catch(u){c(u)}},f=o=>o.done?d(o.value):Promise.resolve(o.value).then(w,C);f((l=l.apply(B,v)).next())});import{_ as G,B as H,u as O,k as g,P as M,r as R,o as K,c as m,d as r,b as n,w as V,e as h,l as T,a as j,n as _,F as z,p as J,m as $,s as b,g as i,t as p,q as P}from"./index-B03wA3Sl.js";const Q={class:"members-page page-container"},W={class:"content-wrapper"},X={class:"card"},Y={class:"card"},Z={key:0,class:"empty-state"},ee=["onClick"],ae={class:"member-header"},se={class:"member-info"},te={class:"member-name"},ne={class:"member-phone"},oe={class:"member-actions"},le={key:0,class:"member-balance"},re={class:"member-footer"},ie={class:"member-level"},ue={key:0,class:"member-discount"},de={key:1,class:"member-stats"},ce={__name:"Members",setup(B){const v=j(),l=H(),d=O(),c=g(()=>d.hasPermission(M.STATS_PROFIT)||d.hasPermission(M.MEMBER_RECHARGE)),w=g(()=>d.hasPermission(M.MEMBER_RECHARGE)),C=g(()=>d.hasPermission(M.MEMBER_DELETE)),f=g(()=>d.hasPermission(M.MEMBER_EDIT)),o=R(""),u=R(!1),t=R({phone:"",name:"",balance:"0",discount:"1.0"}),S=g(()=>o.value?l.searchMembers(o.value):l.getAllMembers),D=()=>{},I=(s,e)=>{e&&e.target.closest(".delete-btn")||(w.value?f.value?P({title:"é€‰æ‹©æ“ä½œ",message:`ä¼šå‘˜ï¼š${s.name||s.phone}
æ‰‹æœºå·ï¼š${s.phone}
å½“å‰ä½™é¢ï¼šÂ¥${s.balance.toFixed(2)}`,confirmButtonText:"å……å€¼",cancelButtonText:"å–æ¶ˆ"}).then(()=>{v.push({name:"MemberRecharge",params:{memberId:s.id}})}).catch(()=>{}):v.push({name:"MemberRecharge",params:{memberId:s.id}}):b(`ä¼šå‘˜ï¼š${s.name||s.phone}
ç­‰çº§ï¼š${s.level}
æŠ˜æ‰£ï¼š${(s.discount*10).toFixed(1)}æŠ˜`))},U=(s,e)=>E(this,null,function*(){e&&e.stopPropagation(),P({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤ä¼šå‘˜"${s.name||s.phone}"å—ï¼Ÿ
åˆ é™¤åŽæ— æ³•æ¢å¤ï¼`,confirmButtonText:"åˆ é™¤",cancelButtonText:"å–æ¶ˆ",confirmButtonColor:"#ee0a24"}).then(()=>E(this,null,function*(){(yield l.deleteMember(s.id))?(b({type:"success",message:"åˆ é™¤æˆåŠŸ"}),yield l.loadMembers()):b("åˆ é™¤å¤±è´¥")})).catch(()=>{})}),F=()=>E(this,null,function*(){if(!t.value.phone){b("è¯·è¾“å…¥æ‰‹æœºå·");return}const s={phone:t.value.phone,name:t.value.name||"",balance:parseFloat(t.value.balance)||0,discount:parseFloat(t.value.discount)||1,totalRecharge:parseFloat(t.value.balance)||0,totalConsumption:0,level:"æ™®é€šä¼šå‘˜"},e=yield l.addMember(s);e.success?(b("æ³¨å†ŒæˆåŠŸ"),u.value=!1,t.value={phone:"",name:"",balance:"0",discount:"1.0"}):b(e.message||"æ³¨å†Œå¤±è´¥")});return K(()=>{l.loadMembers()}),(s,e)=>{const y=h("van-icon"),A=h("van-nav-bar"),q=h("van-search"),k=h("van-field"),N=h("van-form"),L=h("van-dialog");return i(),m("div",Q,[r(A,{title:"ä¼šå‘˜ç®¡ç†","left-arrow":"",onClickLeft:e[2]||(e[2]=a=>T(v).back())},{right:V(()=>[r(y,{name:"records",onClick:e[0]||(e[0]=a=>T(v).push("/member/history")),style:{"margin-right":"16px"}}),r(y,{name:"plus",onClick:e[1]||(e[1]=a=>u.value=!0)})]),_:1}),n("div",W,[n("div",X,[r(q,{modelValue:o.value,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value=a),placeholder:"æœç´¢æ‰‹æœºå·æˆ–å§“å",onSearch:D},null,8,["modelValue"])]),n("div",Y,[e[10]||(e[10]=n("div",{class:"section-title"},"ðŸ‘¥ ä¼šå‘˜åˆ—è¡¨",-1)),S.value.length===0?(i(),m("div",Z,[...e[9]||(e[9]=[n("div",{class:"empty-state-icon"},"ðŸ‘¤",-1),n("div",{class:"empty-state-text"},"æš‚æ— ä¼šå‘˜",-1)])])):_("",!0),(i(!0),m(z,null,J(S.value,a=>(i(),m("div",{key:a.id,class:"member-item",onClick:x=>I(a,x)},[n("div",ae,[n("div",se,[n("div",te,p(a.name||"æœªè®¾ç½®å§“å"),1),n("div",ne,p(a.phone),1)]),n("div",oe,[c.value?(i(),m("div",le,"Â¥"+p(a.balance.toFixed(2)),1)):_("",!0),C.value?(i(),$(y,{key:1,name:"delete-o",class:"delete-btn",onClick:x=>U(a,x)},null,8,["onClick"])):_("",!0)])]),n("div",re,[n("span",ie,p(a.level),1),a.discount<1?(i(),m("span",ue,p((a.discount*10).toFixed(1))+"æŠ˜ ",1)):_("",!0),c.value?(i(),m("span",de," ç´¯è®¡å……å€¼: Â¥"+p(a.totalRecharge.toFixed(2))+" | ç´¯è®¡æ¶ˆè´¹: Â¥"+p(a.totalConsumption.toFixed(2)),1)):_("",!0)])],8,ee))),128))])]),r(L,{show:u.value,"onUpdate:show":e[8]||(e[8]=a=>u.value=a),title:"æ³¨å†Œä¼šå‘˜","show-cancel-button":"",onConfirm:F},{default:V(()=>[r(N,{onSubmit:F},{default:V(()=>[r(k,{modelValue:t.value.phone,"onUpdate:modelValue":e[4]||(e[4]=a=>t.value.phone=a),name:"phone",label:"æ‰‹æœºå·",placeholder:"è¯·è¾“å…¥æ‰‹æœºå·",rules:[{required:!0,message:"è¯·è¾“å…¥æ‰‹æœºå·"}]},null,8,["modelValue"]),r(k,{modelValue:t.value.name,"onUpdate:modelValue":e[5]||(e[5]=a=>t.value.name=a),name:"name",label:"å§“å",placeholder:"è¯·è¾“å…¥å§“åï¼ˆå¯é€‰ï¼‰"},null,8,["modelValue"]),c.value?(i(),$(k,{key:0,modelValue:t.value.balance,"onUpdate:modelValue":e[6]||(e[6]=a=>t.value.balance=a),name:"balance",label:"åˆå§‹ä½™é¢",type:"number",placeholder:"è¯·è¾“å…¥åˆå§‹ä½™é¢",rules:[{required:c.value,message:"è¯·è¾“å…¥åˆå§‹ä½™é¢"}]},{button:V(()=>[...e[11]||(e[11]=[n("span",null,"å…ƒ",-1)])]),_:1},8,["modelValue","rules"])):_("",!0),r(k,{modelValue:t.value.discount,"onUpdate:modelValue":e[7]||(e[7]=a=>t.value.discount=a),name:"discount",label:"ä¼šå‘˜æŠ˜æ‰£",type:"number",placeholder:"1.0è¡¨ç¤ºæ— æŠ˜æ‰£ï¼Œ0.9è¡¨ç¤º9æŠ˜",rules:[{required:!0,message:"è¯·è¾“å…¥æŠ˜æ‰£"}]},null,8,["modelValue"])]),_:1})]),_:1},8,["show"])])}}},ve=G(ce,[["__scopeId","data-v-08ac2788"]]);export{ve as default};
