import{_ as L,j as U,i as V,r as A,k as $,o as M,c as d,d as v,b as t,w as q,e as h,l as I,a as H,n as x,t as l,F as b,p as w,s as J,g as r,v as Y}from"./index-UkLcb2kz.js";const G={class:"daily-report-page page-container"},K={class:"content-wrapper"},Q={class:"date-selector card"},W={class:"summary-section card"},X={class:"summary-grid"},Z={class:"summary-item"},tt={class:"summary-value primary"},st={class:"summary-item"},et={class:"summary-value"},ot={class:"summary-item"},at={class:"summary-value success"},nt={class:"summary-item"},lt={class:"summary-value"},it={class:"stats-section card"},dt={key:0,class:"staff-section card"},rt={class:"staff-list"},ut={class:"staff-rank"},ct={class:"staff-info"},vt={class:"staff-name"},mt={class:"staff-meta"},pt={class:"staff-amount"},_t={class:"staff-sales"},ft={class:"staff-profit"},yt={key:1,class:"hot-products-section card"},ht={class:"hot-list"},gt={class:"hot-image"},Ct=["src","alt"],St={class:"hot-info"},kt={class:"hot-name"},Pt={class:"hot-meta"},xt={class:"hot-stats"},bt={class:"hot-quantity"},wt={class:"hot-amount"},Dt={key:2,class:"details-section card"},qt={class:"order-list"},It={class:"order-header"},Ft={class:"order-time"},At={class:"order-salesperson"},$t={class:"order-products"},Rt={class:"product-name"},Ot={class:"product-quantity"},jt={class:"product-price"},Nt={class:"order-footer"},Tt={class:"order-total"},zt={class:"order-profit"},Bt={key:3,class:"empty-state"},Et={__name:"DailyReport",setup(Lt){const R=H(),F=U(),D=V(),g=A(!1),C=A([new Date().getFullYear(),new Date().getMonth()+1,new Date().getDate()]),O=new Date(2024,0,1),j=new Date,k=$(()=>`${C.value[0]}-${String(C.value[1]).padStart(2,"0")}-${String(C.value[2]).padStart(2,"0")}`),n=$(()=>{const p=k.value,o=new Date(p).setHours(0,0,0,0),S=new Date(p).setHours(23,59,59,999),u=F.getAllSales.filter(e=>{const a=e.time||e.date;return a>=o&&a<=S});if(u.length===0)return{totalSales:0,totalCost:0,totalProfit:0,profitRate:0,orderCount:0,productCount:0,avgOrderAmount:0,avgProductPrice:0,staffStats:[],hotProducts:[],orders:[]};let i=0,P=0,y=0,_=0;u.forEach(e=>{i+=e.totalAmount,y+=e.profit,e.products&&Array.isArray(e.products)?_+=e.products.reduce((a,f)=>a+f.quantity,0):_+=e.quantity||0}),P=i-y;const s={};u.forEach(e=>{const a=e.salesperson||"æœªæŒ‡å®š";s[a]||(s[a]={name:a,orderCount:0,productCount:0,sales:0,profit:0}),s[a].orderCount++,e.products&&Array.isArray(e.products)?s[a].productCount+=e.products.reduce((f,E)=>f+E.quantity,0):s[a].productCount+=e.quantity||0,s[a].sales+=e.totalAmount,s[a].profit+=e.profit});const c=Object.values(s).sort((e,a)=>a.sales-e.sales),m={};u.forEach(e=>{if(e.products&&Array.isArray(e.products))e.products.forEach(a=>{if(!m[a.productId]){const f=D.getProductById(a.productId);m[a.productId]={id:a.productId,name:a.productName,code:a.code,size:a.size,color:a.color,image:(f==null?void 0:f.image)||"",quantity:0,amount:0}}m[a.productId].quantity+=a.quantity,m[a.productId].amount+=a.salePrice*a.quantity});else if(e.productId){if(!m[e.productId]){const a=D.getProductById(e.productId);m[e.productId]={id:e.productId,name:e.productName,brand:e.brand||"",size:e.size||"",image:(a==null?void 0:a.image)||"",quantity:0,amount:0}}m[e.productId].quantity+=e.quantity,m[e.productId].amount+=e.totalAmount}});const B=Object.values(m).sort((e,a)=>a.quantity-e.quantity).slice(0,5);return{totalSales:i,totalCost:P,totalProfit:y,profitRate:i>0?(y/i*100).toFixed(1):0,orderCount:u.length,productCount:_,avgOrderAmount:i/u.length,avgProductPrice:_>0?i/_:0,staffStats:c,hotProducts:B,orders:u.sort((e,a)=>a.time-e.time)}}),N=()=>{g.value=!1},T=p=>{const o=new Date(p);return`${String(o.getHours()).padStart(2,"0")}:${String(o.getMinutes()).padStart(2,"0")}`},z=()=>{const p={date:k.value,summary:{totalSales:n.value.totalSales,totalCost:n.value.totalCost,totalProfit:n.value.totalProfit,profitRate:n.value.profitRate,orderCount:n.value.orderCount,productCount:n.value.productCount},staffStats:n.value.staffStats,hotProducts:n.value.hotProducts,orders:n.value.orders},o=JSON.stringify(p,null,2),S=new Blob([o],{type:"application/json"}),u=URL.createObjectURL(S),i=document.createElement("a");i.href=u,i.download=`è¥ä¸šæŠ¥è¡¨_${k.value}.json`,i.click(),URL.revokeObjectURL(u),J({type:"success",message:"æŠ¥è¡¨å·²å¯¼å‡º"})};return M(()=>{F.loadSales(),D.loadProducts()}),(p,o)=>{const S=h("van-icon"),u=h("van-nav-bar"),i=h("van-cell"),P=h("van-cell-group"),y=h("van-date-picker"),_=h("van-popup");return r(),d("div",G,[v(u,{title:"æ¯æ—¥è¥ä¸šæŠ¥è¡¨","left-arrow":"",onClickLeft:o[0]||(o[0]=s=>I(R).back())},{right:q(()=>[v(S,{name:"share-o",onClick:z})]),_:1}),t("div",K,[t("div",Q,[v(i,{title:"é€‰æ‹©æ—¥æœŸ",value:k.value,"is-link":"",onClick:o[1]||(o[1]=s=>g.value=!0)},null,8,["value"])]),t("div",W,[o[9]||(o[9]=t("div",{class:"section-title"},"ðŸ“Š è¥ä¸šæ¦‚å†µ",-1)),t("div",X,[t("div",Z,[o[5]||(o[5]=t("div",{class:"summary-label"},"é”€å”®é¢",-1)),t("div",tt,"Â¥"+l(n.value.totalSales.toFixed(2)),1)]),t("div",st,[o[6]||(o[6]=t("div",{class:"summary-label"},"æˆæœ¬",-1)),t("div",et,"Â¥"+l(n.value.totalCost.toFixed(2)),1)]),t("div",ot,[o[7]||(o[7]=t("div",{class:"summary-label"},"åˆ©æ¶¦",-1)),t("div",at,"Â¥"+l(n.value.totalProfit.toFixed(2)),1)]),t("div",nt,[o[8]||(o[8]=t("div",{class:"summary-label"},"åˆ©æ¶¦çŽ‡",-1)),t("div",lt,l(n.value.profitRate)+"%",1)])])]),t("div",it,[o[10]||(o[10]=t("div",{class:"section-title"},"ðŸ›’ é”€å”®ç»Ÿè®¡",-1)),v(P,{inset:""},{default:q(()=>[v(i,{title:"è®¢å•æ•°é‡",value:`${n.value.orderCount} å•`},null,8,["value"]),v(i,{title:"å•†å“æ•°é‡",value:`${n.value.productCount} ä»¶`},null,8,["value"]),v(i,{title:"å®¢å•ä»·",value:`Â¥${n.value.avgOrderAmount.toFixed(2)}`},null,8,["value"]),v(i,{title:"ä»¶å•ä»·",value:`Â¥${n.value.avgProductPrice.toFixed(2)}`},null,8,["value"])]),_:1})]),n.value.staffStats.length>0?(r(),d("div",dt,[o[11]||(o[11]=t("div",{class:"section-title"},"ðŸ‘¥ é”€å”®å‘˜ä¸šç»©",-1)),t("div",rt,[(r(!0),d(b,null,w(n.value.staffStats,(s,c)=>(r(),d("div",{key:s.name,class:"staff-item"},[t("div",ut,l(c+1),1),t("div",ct,[t("div",vt,l(s.name),1),t("div",mt,l(s.orderCount)+"å• | "+l(s.productCount)+"ä»¶ ",1)]),t("div",pt,[t("div",_t,"Â¥"+l(s.sales.toFixed(2)),1),t("div",ft,"åˆ©æ¶¦ Â¥"+l(s.profit.toFixed(2)),1)])]))),128))])])):x("",!0),n.value.hotProducts.length>0?(r(),d("div",yt,[o[12]||(o[12]=t("div",{class:"section-title"},"ðŸ”¥ çƒ­é”€å•†å“ TOP5",-1)),t("div",ht,[(r(!0),d(b,null,w(n.value.hotProducts,(s,c)=>(r(),d("div",{key:s.id,class:"hot-item"},[t("div",{class:Y(["hot-rank",`rank-${c+1}`])},l(c+1),3),t("div",gt,[t("img",{src:s.image||"https://via.placeholder.com/50",alt:s.name},null,8,Ct)]),t("div",St,[t("div",kt,l(s.name),1),t("div",Pt,"è´§å·: "+l(s.code)+" | "+l(s.size)+"ç  | "+l(s.color),1)]),t("div",xt,[t("div",bt,"é”€é‡: "+l(s.quantity),1),t("div",wt,"Â¥"+l(s.amount.toFixed(2)),1)])]))),128))])])):x("",!0),n.value.orders.length>0?(r(),d("div",Dt,[o[13]||(o[13]=t("div",{class:"section-title"},"ðŸ“ é”€å”®æ˜Žç»†",-1)),t("div",qt,[(r(!0),d(b,null,w(n.value.orders,s=>(r(),d("div",{key:s.id,class:"order-item"},[t("div",It,[t("span",Ft,l(T(s.time)),1),t("span",At,l(s.salesperson),1)]),t("div",$t,[(r(!0),d(b,null,w(s.products,c=>(r(),d("div",{key:c.productId,class:"order-product"},[t("span",Rt,l(c.productName),1),t("span",Ot,"Ã—"+l(c.quantity),1),t("span",jt,"Â¥"+l(c.salePrice.toFixed(2)),1)]))),128))]),t("div",Nt,[t("span",Tt,"åˆè®¡: Â¥"+l(s.totalAmount.toFixed(2)),1),t("span",zt,"åˆ©æ¶¦: Â¥"+l(s.profit.toFixed(2)),1)])]))),128))])])):x("",!0),n.value.orderCount===0?(r(),d("div",Bt,[...o[14]||(o[14]=[t("div",{class:"empty-icon"},"ðŸ“­",-1),t("div",{class:"empty-text"},"å½“å¤©æš‚æ— é”€å”®è®°å½•",-1)])])):x("",!0)]),v(_,{show:g.value,"onUpdate:show":o[4]||(o[4]=s=>g.value=s),position:"bottom"},{default:q(()=>[v(y,{modelValue:C.value,"onUpdate:modelValue":o[2]||(o[2]=s=>C.value=s),title:"é€‰æ‹©æ—¥æœŸ","min-date":I(O),"max-date":I(j),onConfirm:N,onCancel:o[3]||(o[3]=s=>g.value=!1)},null,8,["modelValue","min-date","max-date"])]),_:1},8,["show"])])}}},Vt=L(Et,[["__scopeId","data-v-b73baa13"]]);export{Vt as default};
