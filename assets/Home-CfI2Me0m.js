var F=(E,r,w)=>new Promise((S,a)=>{var A=c=>{try{k(w.next(c))}catch(y){a(y)}},b=c=>{try{k(w.throw(c))}catch(y){a(y)}},k=c=>c.done?S(c.value):Promise.resolve(c.value).then(A,b);k((w=w.apply(E,r)).next())});import{_ as H,i as j,j as K,u as Y,r as U,o as G,a as J,k as $,P as l,c as v,b as e,d,t as n,l as t,R as Q,m as h,n as u,e as g,F as x,p as N,w as p,f as P,g as i,q as X,s as V,h as Z}from"./index-DxGdjJ-k.js";const ss={class:"home-page"},ts={class:"header"},es={class:"header-content"},os={class:"header-top"},as={class:"user-avatar"},ns={class:"user-detail"},is={class:"user-name"},ls={class:"user-role"},rs={class:"header-actions"},ds={class:"subtitle"},us={class:"content-wrapper"},cs={class:"stats-grid"},vs={class:"stat-info"},ms={class:"stat-value stat-value-primary"},ps={class:"stat-info"},_s={class:"stat-value stat-value-success"},fs={class:"stat-info"},ws={class:"stat-value"},gs={class:"stat-info"},Ps={class:"stat-value"},Ss={key:0,class:"card"},ks={class:"warning-list"},hs=["onClick"],bs={class:"warning-info"},ys={class:"warning-name"},Ts={class:"warning-detail"},As={class:"warning-stock"},Cs={class:"stock-badge low"},Rs={key:1,class:"card"},Us={class:"staff-stats"},Vs={class:"staff-info"},Fs={class:"staff-name"},Es={class:"staff-detail"},Is={class:"staff-amount"},$s={key:0,class:"staff-sales"},xs={key:1,class:"staff-profit"},Ns={key:2,class:"card"},Ds={class:"card"},Os={class:"quick-actions"},Ms={key:2,class:"action-row"},zs={key:3,class:"card"},Ls={class:"month-stats"},qs={class:"month-stat-item"},Bs={class:"month-stat-value primary"},Ws={class:"month-stat-item"},Hs={class:"month-stat-value success"},js={class:"user-menu-header"},Ks={class:"menu-avatar"},Ys={class:"menu-info"},Gs={class:"menu-name"},Js={class:"menu-role"},Qs={__name:"Home",setup(E){const r=J(),w=j(),S=K(),a=Y(),A=U(0);G(()=>F(this,null,function*(){a.currentUser||(localStorage.getItem("currentUser")?(console.log("æ£€æµ‹åˆ°æœªåŒæ­¥çš„ç™»å½•çŠ¶æ€ï¼Œé‡æ–°åŠ è½½ç”¨æˆ·æ•°æ®..."),yield a.loadUsers(),a.currentUser||(console.warn("ç™»å½•çŠ¶æ€å·²è¿‡æœŸï¼Œè·³è½¬åˆ°ç™»å½•é¡µ"),r.replace("/login"))):r.replace("/login"))}));const b=U(!1),k=U(!1),c=U({oldPassword:"",newPassword:"",confirmPassword:""}),y=m=>Q[m]||"æœªçŸ¥",D=$(()=>{const m=[{name:"ä¿®æ”¹å¯†ç ",value:"changePassword"}];return a.hasPermission(l.USER_VIEW)&&(m.push({name:"ç”¨æˆ·ç®¡ç†",value:"userManagement"}),m.push({name:"æ“ä½œæ—¥å¿—",value:"operationLogs"})),m.push({name:"é€€å‡ºç™»å½•",value:"logout",color:"#ee0a24"}),m}),O=m=>F(this,null,function*(){switch(m.value){case"changePassword":c.value={oldPassword:"",newPassword:"",confirmPassword:""},k.value=!0;break;case"userManagement":r.push("/user-management");break;case"operationLogs":r.push("/operation-logs");break;case"logout":try{yield X({title:"é€€å‡ºç™»å½•",message:"ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ"}),a.logout(),r.replace("/login")}catch(s){}break}}),M=m=>new Promise(s=>{if(m==="confirm"){const{oldPassword:_,newPassword:f,confirmPassword:C}=c.value;if(!_||!f||!C){V("è¯·å¡«å†™å®Œæ•´ä¿¡æ¯"),s(!1);return}if(f!==C){V("ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸ä¸€è‡´"),s(!1);return}if(f.length<6){V("å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½"),s(!1);return}const T=a.changePassword(_,f);T.success?(Z("å¯†ç ä¿®æ”¹æˆåŠŸ"),s(!0)):(V(T.message),s(!1))}else s(!0)}),z=$(()=>{const m=new Date,s={year:"numeric",month:"long",day:"numeric",weekday:"long"};return m.toLocaleDateString("zh-CN",s)});return(m,s)=>{var I;const _=g("van-icon"),f=g("van-button"),C=g("van-action-sheet"),T=g("van-field"),L=g("van-cell-group"),q=g("van-form"),B=g("van-dialog"),R=g("van-tabbar-item"),W=g("van-tabbar");return i(),v("div",ss,[e("div",ts,[e("div",es,[e("div",os,[e("div",{class:"user-info",onClick:s[0]||(s[0]=o=>b.value=!0)},[e("div",as,n(((I=t(a).currentUserName)==null?void 0:I.charAt(0))||"?"),1),e("div",ns,[e("div",is,n(t(a).currentUserName||"æœªç™»å½•"),1),e("div",ls,n(y(t(a).currentRole)),1)])]),e("div",rs,[t(a).hasPermission(t(l).USER_VIEW)?(i(),h(_,{key:0,name:"manager-o",size:"22",onClick:s[1]||(s[1]=o=>t(r).push("/user-management"))})):u("",!0),d(_,{name:"setting-o",size:"22",onClick:s[2]||(s[2]=o=>b.value=!0)})])]),s[19]||(s[19]=e("h1",{class:"title"},"é‹åº—ç®¡ç†ç³»ç»Ÿ",-1)),e("p",ds,n(z.value),1)])]),e("div",us,[e("div",cs,[t(a).hasPermission(t(l).STATS_PROFIT)?(i(),v("div",{key:0,class:"stat-card",onClick:s[3]||(s[3]=o=>t(r).push("/statistics"))},[s[21]||(s[21]=e("div",{class:"stat-icon stat-icon-primary"}," ğŸ’° ",-1)),e("div",vs,[s[20]||(s[20]=e("div",{class:"stat-label"},"ä»Šæ—¥é”€å”®é¢",-1)),e("div",ms,"Â¥"+n(t(S).todaySales.toFixed(2)),1)])])):u("",!0),t(a).hasPermission(t(l).STATS_PROFIT)?(i(),v("div",{key:1,class:"stat-card",onClick:s[4]||(s[4]=o=>t(r).push("/statistics"))},[s[23]||(s[23]=e("div",{class:"stat-icon stat-icon-success"}," ğŸ“ˆ ",-1)),e("div",ps,[s[22]||(s[22]=e("div",{class:"stat-label"},"ä»Šæ—¥åˆ©æ¶¦",-1)),e("div",_s,"Â¥"+n(t(S).todayProfit.toFixed(2)),1)])])):u("",!0),e("div",{class:"stat-card",onClick:s[5]||(s[5]=o=>t(r).push("/products"))},[s[25]||(s[25]=e("div",{class:"stat-icon stat-icon-info"}," ğŸ‘Ÿ ",-1)),e("div",fs,[s[24]||(s[24]=e("div",{class:"stat-label"},"å•†å“æ€»æ•°",-1)),e("div",ws,n(t(w).totalProducts),1)])]),t(a).hasPermission(t(l).STATS_PROFIT)?(i(),v("div",{key:2,class:"stat-card",onClick:s[6]||(s[6]=o=>t(r).push("/products"))},[s[27]||(s[27]=e("div",{class:"stat-icon stat-icon-warning"}," ğŸ“¦ ",-1)),e("div",gs,[s[26]||(s[26]=e("div",{class:"stat-label"},"åº“å­˜æ€»å€¼",-1)),e("div",Ps,"Â¥"+n(t(w).totalStockValue.toFixed(0)),1)])])):u("",!0)]),t(w).lowStockProducts.length>0&&t(a).hasPermission(t(l).INVENTORY_VIEW)?(i(),v("div",Ss,[s[28]||(s[28]=e("div",{class:"section-title"},"âš ï¸ ä½åº“å­˜é¢„è­¦",-1)),e("div",ks,[(i(!0),v(x,null,N(t(w).lowStockProducts,o=>(i(),v("div",{key:o.id,class:"warning-item",onClick:Xs=>t(a).hasPermission(t(l).PRODUCT_EDIT)&&t(r).push(`/product/edit/${o.id}`)},[e("div",bs,[e("div",ys,n(o.name),1),e("div",Ts," è´§å·: "+n(o.code)+" | "+n(o.size)+"ç  | "+n(o.color),1)]),e("div",As,[e("span",Cs,"å‰©ä½™ "+n(o.stock),1)])],8,hs))),128))])])):u("",!0),t(S).todaySalespersonStats.length>0&&t(a).hasPermission(t(l).STAFF_STATS_ALL)?(i(),v("div",Rs,[s[29]||(s[29]=e("div",{class:"section-title"},"ğŸ‘¥ ä»Šæ—¥ä¸šç»©",-1)),e("div",Us,[(i(!0),v(x,null,N(t(S).todaySalespersonStats,o=>(i(),v("div",{key:o.name,class:"staff-item"},[e("div",Vs,[e("div",Fs,n(o.name),1),e("div",Es,n(o.salesCount)+"å• | "+n(o.quantity)+"ä»¶",1)]),e("div",Is,[t(a).hasPermission(t(l).STATS_PROFIT)?(i(),v("div",$s," Â¥"+n(o.totalAmount.toFixed(0)),1)):u("",!0),t(a).hasPermission(t(l).STATS_PROFIT)?(i(),v("div",xs," åˆ©æ¶¦ Â¥"+n(o.totalProfit.toFixed(0)),1)):u("",!0)])]))),128))])])):u("",!0),t(a).hasPermission(t(l).MEMBER_VIEW)?(i(),v("div",Ns,[s[32]||(s[32]=e("div",{class:"section-title"},"ğŸ‘¥ ä¼šå‘˜ç®¡ç†",-1)),e("div",{class:"quick-action",onClick:s[7]||(s[7]=o=>t(r).push("/members"))},[s[30]||(s[30]=e("div",{class:"action-icon"},"ğŸ’³",-1)),s[31]||(s[31]=e("div",{class:"action-text"},"æŸ¥çœ‹å’Œç®¡ç†ä¼šå‘˜ä¿¡æ¯",-1)),d(_,{name:"arrow",class:"action-arrow"})])])):u("",!0),e("div",Ds,[s[38]||(s[38]=e("div",{class:"section-title"},"ğŸš€ å¿«æ·æ“ä½œ",-1)),e("div",Os,[t(a).hasPermission(t(l).SALES_ADD)?(i(),h(f,{key:0,type:"primary",size:"large",block:"",class:"action-btn",onClick:s[8]||(s[8]=o=>t(r).push("/sales/add"))},{default:p(()=>[d(_,{name:"shopping-cart-o"}),s[33]||(s[33]=P(" æ”¶é“¶å° ",-1))]),_:1})):u("",!0),t(a).hasPermission(t(l).PURCHASE_ADD)?(i(),h(f,{key:1,type:"success",size:"large",block:"",class:"action-btn",onClick:s[9]||(s[9]=o=>t(r).push("/purchase"))},{default:p(()=>[d(_,{name:"add-o"}),s[34]||(s[34]=P(" è¿›è´§ ",-1))]),_:1})):u("",!0),t(a).hasPermission(t(l).STATS_REPORT)||t(a).hasPermission(t(l).STAFF_STATS_VIEW)?(i(),v("div",Ms,[t(a).hasPermission(t(l).STATS_REPORT)?(i(),h(f,{key:0,type:"default",size:"large",class:"action-btn half backup-btn",onClick:s[10]||(s[10]=o=>t(r).push("/daily-report"))},{default:p(()=>[d(_,{name:"description"}),s[35]||(s[35]=P(" æ¯æ—¥æŠ¥è¡¨ ",-1))]),_:1})):u("",!0),t(a).hasPermission(t(l).STAFF_STATS_VIEW)?(i(),h(f,{key:1,type:"default",size:"large",class:"action-btn half stats-btn",onClick:s[11]||(s[11]=o=>t(r).push("/staff-stats"))},{default:p(()=>[d(_,{name:"friends-o"}),s[36]||(s[36]=P(" å‘˜å·¥ä¸šç»© ",-1))]),_:1})):u("",!0)])):u("",!0),t(a).hasPermission(t(l).DATA_BACKUP)?(i(),h(f,{key:3,type:"default",size:"large",block:"",class:"action-btn backup-btn",onClick:s[12]||(s[12]=o=>t(r).push("/data-management"))},{default:p(()=>[d(_,{name:"records"}),s[37]||(s[37]=P(" æ•°æ®å¤‡ä»½ ",-1))]),_:1})):u("",!0)])]),t(a).hasPermission(t(l).STATS_PROFIT)?(i(),v("div",zs,[s[42]||(s[42]=e("div",{class:"section-title"},"ğŸ“Š æœ¬æœˆæ•°æ®",-1)),e("div",Ls,[e("div",qs,[s[39]||(s[39]=e("div",{class:"month-stat-label"},"é”€å”®é¢",-1)),e("div",Bs,"Â¥"+n(t(S).monthSales.toFixed(2)),1)]),s[41]||(s[41]=e("div",{class:"month-stat-divider"},null,-1)),e("div",Ws,[s[40]||(s[40]=e("div",{class:"month-stat-label"},"åˆ©æ¶¦",-1)),e("div",Hs,"Â¥"+n(t(S).monthProfit.toFixed(2)),1)])])])):u("",!0)]),d(C,{show:b.value,"onUpdate:show":s[13]||(s[13]=o=>b.value=o),actions:D.value,"cancel-text":"å–æ¶ˆ","close-on-click-action":"",onSelect:O},{description:p(()=>{var o;return[e("div",js,[e("div",Ks,n(((o=t(a).currentUserName)==null?void 0:o.charAt(0))||"?"),1),e("div",Ys,[e("div",Gs,n(t(a).currentUserName),1),e("div",Js,n(y(t(a).currentRole)),1)])])]}),_:1},8,["show","actions"]),d(B,{show:k.value,"onUpdate:show":s[17]||(s[17]=o=>k.value=o),title:"ä¿®æ”¹å¯†ç ","show-cancel-button":"","before-close":M},{default:p(()=>[d(q,{ref:"passwordForm"},{default:p(()=>[d(L,{inset:""},{default:p(()=>[d(T,{modelValue:c.value.oldPassword,"onUpdate:modelValue":s[14]||(s[14]=o=>c.value.oldPassword=o),type:"password",label:"åŸå¯†ç ",placeholder:"è¯·è¾“å…¥åŸå¯†ç ",rules:[{required:!0,message:"è¯·è¾“å…¥åŸå¯†ç "}]},null,8,["modelValue"]),d(T,{modelValue:c.value.newPassword,"onUpdate:modelValue":s[15]||(s[15]=o=>c.value.newPassword=o),type:"password",label:"æ–°å¯†ç ",placeholder:"è¯·è¾“å…¥æ–°å¯†ç ",rules:[{required:!0,message:"è¯·è¾“å…¥æ–°å¯†ç "}]},null,8,["modelValue"]),d(T,{modelValue:c.value.confirmPassword,"onUpdate:modelValue":s[16]||(s[16]=o=>c.value.confirmPassword=o),type:"password",label:"ç¡®è®¤å¯†ç ",placeholder:"è¯·å†æ¬¡è¾“å…¥æ–°å¯†ç ",rules:[{required:!0,message:"è¯·ç¡®è®¤æ–°å¯†ç "}]},null,8,["modelValue"])]),_:1})]),_:1},512)]),_:1},8,["show"]),d(W,{modelValue:A.value,"onUpdate:modelValue":s[18]||(s[18]=o=>A.value=o),"active-color":"#1989fa","inactive-color":"#7d7e80"},{default:p(()=>[d(R,{icon:"home-o",to:"/home"},{default:p(()=>[...s[43]||(s[43]=[P("é¦–é¡µ",-1)])]),_:1}),d(R,{icon:"bag-o",to:"/products"},{default:p(()=>[...s[44]||(s[44]=[P("å•†å“",-1)])]),_:1}),d(R,{icon:"shopping-cart-o",to:"/sales"},{default:p(()=>[...s[45]||(s[45]=[P("é”€å”®",-1)])]),_:1}),t(a).hasPermission(t(l).STATS_PROFIT)?(i(),h(R,{key:0,icon:"bar-chart-o",to:"/statistics"},{default:p(()=>[...s[46]||(s[46]=[P(" ç»Ÿè®¡ ",-1)])]),_:1})):u("",!0)]),_:1},8,["modelValue"])])}}},tt=H(Qs,[["__scopeId","data-v-b9bf8312"]]);export{tt as default};
