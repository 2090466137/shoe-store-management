var C=(k,q,d)=>new Promise((m,u)=>{var f=r=>{try{s(d.next(r))}catch(p){u(p)}},c=r=>{try{s(d.throw(r))}catch(p){u(p)}},s=r=>r.done?m(r.value):Promise.resolve(r.value).then(f,c);s((d=d.apply(k,q)).next())});import{_ as j,i as E,j as H,r as _,k as $,c as P,d as l,b as a,l as V,a as Q,e as v,w as y,f as R,n as G,F as J,p as K,s as n,g as b,t as g,x as W,q as X}from"./index-DxGdjJ-k.js";const Y={class:"purchase-page page-container"},Z={class:"content-wrapper"},O={class:"card"},h={style:{margin:"16px"}},ee={class:"card"},te={key:0,class:"empty-state"},se={class:"record-header"},oe={class:"record-product"},ae={class:"record-header-right"},ne={class:"record-amount"},le={class:"record-info"},ue={class:"record-footer"},re={class:"record-supplier"},ie={class:"record-date"},de={class:"popup-header"},ce={__name:"Purchase",setup(k){const q=Q(),d=E(),m=H(),u=_(!1),f=_(""),c=_(null),s=_({productId:"",quantity:"",costPrice:"",supplier:""}),r=$(()=>d.getAllProducts.map(t=>({text:`${t.name} (è´§å·: ${t.code} | ${t.size}ç )`,value:t.id}))),p=$(()=>{const t=parseFloat(s.value.quantity)||0,e=parseFloat(s.value.costPrice)||0;return(t*e).toFixed(2)}),w=({selectedOptions:t})=>{const e=t[0].value;c.value=d.getProductById(e),c.value&&(s.value.productId=e,f.value=t[0].text,s.value.costPrice=c.value.costPrice.toString(),s.value.supplier=c.value.supplier||""),u.value=!1},x=t=>{const e=parseFloat(t);return!isNaN(e)&&e>0},F=t=>{const e=parseInt(t);return!isNaN(e)&&e>0&&Number.isInteger(parseFloat(t))},S=()=>{const t=parseInt(s.value.quantity);isNaN(t)||t<0?(s.value.quantity="1",n("è¿›è´§æ•°é‡ä¸èƒ½ä¸ºè´Ÿæ•°ï¼Œå·²è°ƒæ•´ä¸º1")):t===0?(s.value.quantity="1",n("è¿›è´§æ•°é‡ä¸èƒ½ä¸º0ï¼Œå·²è°ƒæ•´ä¸º1")):Number.isInteger(parseFloat(s.value.quantity))?t>999999&&(s.value.quantity="999999",n("è¿›è´§æ•°é‡è¿‡å¤§ï¼Œå·²è°ƒæ•´ä¸º999999")):(s.value.quantity=Math.floor(t).toString(),n("è¿›è´§æ•°é‡å¿…é¡»ä¸ºæ•´æ•°"))},B=()=>{const t=parseFloat(s.value.costPrice);isNaN(t)||t<0?(s.value.costPrice="0",n("è¿›è´§å•ä»·ä¸èƒ½ä¸ºè´Ÿæ•°")):t<.01&&t!==0?(s.value.costPrice="0.01",n("è¿›è´§å•ä»·è¿‡å°ï¼Œå·²è°ƒæ•´ä¸º0.01å…ƒ")):t>999999&&(s.value.costPrice="999999",n("è¿›è´§å•ä»·è¿‡å¤§ï¼Œå·²è°ƒæ•´ä¸º999999å…ƒ"))},D=()=>{if(!s.value.productId){n({type:"fail",message:"è¯·é€‰æ‹©å•†å“"});return}const t=parseInt(s.value.quantity),e=parseFloat(s.value.costPrice);if(isNaN(t)||t<=0){n("è¯·è¾“å…¥æœ‰æ•ˆçš„è¿›è´§æ•°é‡ï¼ˆå¿…é¡»å¤§äº0ï¼‰");return}if(!Number.isInteger(t)){n("è¿›è´§æ•°é‡å¿…é¡»ä¸ºæ•´æ•°");return}if(isNaN(e)||e<=0){n("è¯·è¾“å…¥æœ‰æ•ˆçš„è¿›è´§å•ä»·ï¼ˆå¿…é¡»å¤§äº0ï¼‰");return}if(e>999999){n("è¿›è´§å•ä»·è¿‡å¤§ï¼Œè¯·æ£€æŸ¥è¾“å…¥");return}const N={productId:s.value.productId,quantity:t,costPrice:e,supplier:s.value.supplier},i=m.addPurchase(N);i.success?(n({type:"success",message:"è¿›è´§æˆåŠŸ"}),s.value={productId:"",quantity:"",costPrice:"",supplier:""},f.value="",c.value=null):n({type:"fail",message:i.message})},U=t=>C(this,null,function*(){try{yield X({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤è¿™æ¡è¿›è´§è®°å½•å—ï¼Ÿ

å•†å“ï¼š${t.productName}
æ•°é‡ï¼š${t.quantity}ä»¶
é‡‘é¢ï¼šÂ¥${t.totalAmount.toFixed(2)}

åˆ é™¤åå°†å‡å°‘å¯¹åº”çš„åº“å­˜ã€‚`,confirmButtonText:"ç¡®è®¤åˆ é™¤",confirmButtonColor:"#ee0a24"}),(yield m.deletePurchase(t.id))?n({type:"success",message:"å·²åˆ é™¤è¿›è´§è®°å½•"}):n({type:"fail",message:"åˆ é™¤å¤±è´¥"})}catch(e){}}),A=t=>{const e=new Date(t);return`${e.getMonth()+1}æœˆ${e.getDate()}æ—¥ ${e.getHours()}:${String(e.getMinutes()).padStart(2,"0")}`};return(t,e)=>{const N=v("van-nav-bar"),i=v("van-field"),M=v("van-button"),T=v("van-form"),I=v("van-icon"),z=v("van-picker"),L=v("van-popup");return b(),P("div",Y,[l(N,{title:"è¿›è´§ç®¡ç†","left-arrow":"",onClickLeft:e[0]||(e[0]=o=>V(q).back())}),a("div",Z,[a("div",O,[e[14]||(e[14]=a("div",{class:"section-title"},"ğŸ“¦ å•†å“è¿›è´§",-1)),l(T,{onSubmit:D},{default:y(()=>[l(i,{modelValue:f.value,"onUpdate:modelValue":e[1]||(e[1]=o=>f.value=o),name:"product",label:"é€‰æ‹©å•†å“",placeholder:"è¯·é€‰æ‹©å•†å“",readonly:"","is-link":"",onClick:e[2]||(e[2]=o=>u.value=!0),rules:[{required:!0,message:"è¯·é€‰æ‹©å•†å“"}]},null,8,["modelValue"]),l(i,{modelValue:s.value.quantity,"onUpdate:modelValue":e[3]||(e[3]=o=>s.value.quantity=o),name:"quantity",type:"number",label:"è¿›è´§æ•°é‡",placeholder:"è¯·è¾“å…¥è¿›è´§æ•°é‡",rules:[{required:!0,message:"è¯·è¾“å…¥è¿›è´§æ•°é‡"},{validator:F,message:"æ•°é‡å¿…é¡»ä¸ºæ­£æ•´æ•°"}],onBlur:S},{button:y(()=>[...e[10]||(e[10]=[a("span",null,"ä»¶",-1)])]),_:1},8,["modelValue","rules"]),l(i,{modelValue:s.value.costPrice,"onUpdate:modelValue":e[4]||(e[4]=o=>s.value.costPrice=o),name:"costPrice",type:"number",label:"è¿›è´§å•ä»·",placeholder:"è¯·è¾“å…¥è¿›è´§å•ä»·",rules:[{required:!0,message:"è¯·è¾“å…¥è¿›è´§å•ä»·"},{validator:x,message:"å•ä»·å¿…é¡»å¤§äº0"}],onBlur:B},{button:y(()=>[...e[11]||(e[11]=[a("span",null,"å…ƒ",-1)])]),_:1},8,["modelValue","rules"]),l(i,{modelValue:p.value,"onUpdate:modelValue":e[5]||(e[5]=o=>p.value=o),name:"totalAmount",label:"è¿›è´§æ€»é¢",readonly:"",value:p.value},{button:y(()=>[...e[12]||(e[12]=[a("span",null,"å…ƒ",-1)])]),_:1},8,["modelValue","value"]),l(i,{modelValue:s.value.supplier,"onUpdate:modelValue":e[6]||(e[6]=o=>s.value.supplier=o),name:"supplier",label:"ä¾›åº”å•†",placeholder:"è¯·è¾“å…¥ä¾›åº”å•†åç§°"},null,8,["modelValue"]),a("div",h,[l(M,{round:"",block:"",type:"success","native-type":"submit",size:"large"},{default:y(()=>[...e[13]||(e[13]=[R(" ç¡®è®¤è¿›è´§ ",-1)])]),_:1})])]),_:1})]),a("div",ee,[e[16]||(e[16]=a("div",{class:"section-title"},"ğŸ“‹ è¿›è´§è®°å½•",-1)),V(m).purchases.length===0?(b(),P("div",te,[...e[15]||(e[15]=[a("div",{class:"empty-state-icon"},"ğŸ“¦",-1),a("div",{class:"empty-state-text"},"æš‚æ— è¿›è´§è®°å½•",-1)])])):G("",!0),(b(!0),P(J,null,K(V(m).purchases,o=>(b(),P("div",{key:o.id,class:"record-item"},[a("div",se,[a("div",oe,g(o.productName),1),a("div",ae,[a("div",ne,"Â¥"+g(o.totalAmount.toFixed(2)),1),l(I,{name:"delete-o",class:"delete-btn",onClick:W(pe=>U(o),["stop"])},null,8,["onClick"])])]),a("div",le,[a("span",null,"æ•°é‡: "+g(o.quantity)+"ä»¶",1),a("span",null,"å•ä»·: Â¥"+g(o.costPrice),1)]),a("div",ue,[a("span",re,g(o.supplier),1),a("span",ie,g(A(o.date)),1)])]))),128))])]),l(L,{show:u.value,"onUpdate:show":e[9]||(e[9]=o=>u.value=o),position:"bottom",round:""},{default:y(()=>[a("div",de,[e[17]||(e[17]=a("span",null,null,-1)),e[18]||(e[18]=a("span",{class:"popup-title"},"é€‰æ‹©å•†å“",-1)),l(I,{name:"cross",class:"popup-close",onClick:e[7]||(e[7]=o=>u.value=!1)})]),l(z,{columns:r.value,onConfirm:w,onCancel:e[8]||(e[8]=o=>u.value=!1)},null,8,["columns"])]),_:1},8,["show"])])}}},fe=j(ce,[["__scopeId","data-v-473d3b4d"]]);export{fe as default};
