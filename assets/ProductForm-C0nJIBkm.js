var O=Object.defineProperty,h=Object.defineProperties;var ee=Object.getOwnPropertyDescriptors;var B=Object.getOwnPropertySymbols;var oe=Object.prototype.hasOwnProperty,le=Object.prototype.propertyIsEnumerable;var q=(m,r,i)=>r in m?O(m,r,{enumerable:!0,configurable:!0,writable:!0,value:i}):m[r]=i,A=(m,r)=>{for(var i in r||(r={}))oe.call(r,i)&&q(m,i,r[i]);if(B)for(var i of B(r))le.call(r,i)&&q(m,i,r[i]);return m},R=(m,r)=>h(m,ee(r));import{_ as ae,i as te,r as f,k as C,o as se,y as re,c as ne,d as t,b as d,l as ue,a as ie,e as v,w as n,f as w,t as de,s,g as me}from"./index-UkLcb2kz.js";const ve={class:"product-form-page page-container"},ce={class:"content-wrapper"},pe={class:"upload-placeholder"},ge={class:"form-actions"},fe={style:{padding:"16px","padding-top":"40px"}},be={__name:"ProductForm",setup(m){const r=ie(),i=re(),y=te(),V=f(!1),g=f(!1),b=f(!1),P=f([]),p=f(""),$=["高跟鞋","平底鞋","运动鞋","休闲鞋","凉鞋","拖鞋","靴子","单鞋","帆布鞋","板鞋","厚底鞋","其他"],D=C(()=>{const l=new Set;return y.getAllProducts.forEach(e=>{e.category&&e.category.trim()&&l.add(e.category)}),Array.from(l).sort()}),L=C(()=>{const l=new Set([...$,...D.value]);return Array.from(l).sort()}),M=["30","31","32","33","34","35","36","37","38","39","40","41","42"],o=f({code:"",color:"",size:"",category:"",costPrice:"",salePrice:"",stock:"",minStock:"5",supplier:"",image:""}),S=C(()=>{const l=[];return o.value.code&&l.push(o.value.code),o.value.color&&l.push(o.value.color),o.value.size&&l.push(o.value.size+"码"),l.length>0?l.join("-"):"（自动生成）"});se(()=>{const l=i.params.id;if(l){V.value=!0;const e=y.getProductById(l);e&&(o.value={code:e.code||e.brand||"",color:e.color||"",size:e.size||"",category:e.category||"",costPrice:e.costPrice.toString(),salePrice:e.salePrice.toString(),stock:e.stock.toString(),minStock:e.minStock.toString(),supplier:e.supplier||"",image:e.image||""},e.image&&(P.value=[{url:e.image,isImage:!0}]))}});const E=l=>{const e=new FileReader;e.onload=c=>{o.value.image=c.target.result,P.value=[{url:c.target.result,isImage:!0}]},e.readAsDataURL(l.file)},T=()=>(o.value.image="",!0),j=()=>{p.value&&p.value.trim()?(o.value.category=p.value.trim(),g.value=!1,p.value="",s("已使用自定义分类")):s("请输入分类名称")},Y=({selectedOptions:l})=>{o.value.category=l[0].text||l[0],g.value=!1,p.value=""},G=({selectedOptions:l})=>{o.value.size=l[0].text||l[0],b.value=!1},z=l=>{const e=parseFloat(l);return!isNaN(e)&&e>0},U=l=>{const e=parseInt(l);return!isNaN(e)&&e>=0&&Number.isInteger(parseFloat(l))},H=()=>{const l=parseFloat(o.value.costPrice);isNaN(l)||l<0?(o.value.costPrice="0",s("成本价不能为负数")):l<.01&&l!==0?(o.value.costPrice="0.01",s("成本价过小，已调整为0.01元")):l>999999&&(o.value.costPrice="999999",s("成本价过大，已调整为999999元"))},J=()=>{const l=parseFloat(o.value.salePrice);isNaN(l)||l<0?(o.value.salePrice="0",s("销售价不能为负数")):l<.01&&l!==0?(o.value.salePrice="0.01",s("销售价过小，已调整为0.01元")):l>999999&&(o.value.salePrice="999999",s("销售价过大，已调整为999999元"))},K=()=>{const l=parseInt(o.value.stock);isNaN(l)||l<0?(o.value.stock="0",s("库存不能为负数")):Number.isInteger(parseFloat(o.value.stock))?l>9999999&&(o.value.stock="9999999",s("库存数量过大")):(o.value.stock=Math.floor(l).toString(),s("库存必须为整数"))},Q=()=>{const l=parseInt(o.value.minStock);isNaN(l)||l<0?(o.value.minStock="0",s("最低库存不能为负数")):Number.isInteger(parseFloat(o.value.minStock))?l>9999&&(o.value.minStock="9999",s("最低库存预警值过大")):(o.value.minStock=Math.floor(l).toString(),s("最低库存必须为整数"))},W=()=>{const l=parseFloat(o.value.costPrice),e=parseFloat(o.value.salePrice),c=parseInt(o.value.stock),k=parseInt(o.value.minStock);if(isNaN(l)||l<0){s("请输入有效的成本价");return}if(isNaN(e)||e<0){s("请输入有效的销售价");return}if(isNaN(c)||c<0){s("请输入有效的库存数量");return}if(isNaN(k)||k<0){s("请输入有效的最低库存");return}const x=S.value==="（自动生成）"?"未命名商品":S.value,u=o.value.code||"无品牌",N=R(A({},o.value),{name:x,brand:u,costPrice:l,salePrice:e,stock:c,minStock:k});V.value?(y.updateProduct(i.params.id,N),s({type:"success",message:"修改成功"})):(y.addProduct(N),s({type:"success",message:"添加成功"})),r.back()};return(l,e)=>{const c=v("van-nav-bar"),k=v("van-icon"),x=v("van-uploader"),u=v("van-field"),N=v("van-cell-group"),I=v("van-button"),X=v("van-form"),Z=v("van-divider"),_=v("van-picker"),F=v("van-popup");return me(),ne("div",ve,[t(c,{title:V.value?"编辑商品":"添加商品","left-arrow":"",onClickLeft:e[0]||(e[0]=a=>ue(r).back())},null,8,["title"]),d("div",ce,[t(X,{onSubmit:W},{default:n(()=>[t(N,{inset:""},{default:n(()=>[t(u,{name:"image",label:"商品图片"},{input:n(()=>[t(x,{modelValue:P.value,"onUpdate:modelValue":e[1]||(e[1]=a=>P.value=a),"max-count":1,"after-read":E,"before-delete":T},{default:n(()=>[d("div",pe,[t(k,{name:"photograph",size:"40"}),e[19]||(e[19]=d("div",{class:"upload-text"},"点击上传图片",-1))])]),_:1},8,["modelValue"])]),_:1}),t(u,{modelValue:o.value.code,"onUpdate:modelValue":e[2]||(e[2]=a=>o.value.code=a),name:"code",label:"货号",placeholder:"例如：206731-2 或 AYL505610-1",rules:[{required:!0,message:"请输入货号"}]},{extra:n(()=>[...e[20]||(e[20]=[d("span",{class:"code-hint"},"支持字母数字组合",-1)])]),_:1},8,["modelValue"]),t(u,{modelValue:o.value.color,"onUpdate:modelValue":e[3]||(e[3]=a=>o.value.color=a),name:"color",label:"颜色",placeholder:"请输入颜色",rules:[{required:!0,message:"请输入颜色"}]},null,8,["modelValue"]),t(u,{modelValue:o.value.size,"onUpdate:modelValue":e[4]||(e[4]=a=>o.value.size=a),name:"size",label:"尺码",placeholder:"请选择尺码",readonly:"","is-link":"",onClick:e[5]||(e[5]=a=>b.value=!0),rules:[{required:!0,message:"请选择尺码"}]},null,8,["modelValue"]),t(u,{modelValue:o.value.category,"onUpdate:modelValue":e[6]||(e[6]=a=>o.value.category=a),name:"category",label:"分类",placeholder:"请输入或选择分类（可选）","is-link":"",onClick:e[7]||(e[7]=a=>g.value=!0)},{extra:n(()=>[...e[21]||(e[21]=[d("span",{style:{"font-size":"12px",color:"#969799"}},"可自定义",-1)])]),_:1},8,["modelValue"]),t(u,{modelValue:S.value,"onUpdate:modelValue":e[8]||(e[8]=a=>S.value=a),name:"displayName",label:"显示名称",placeholder:"自动生成",readonly:"",disabled:""},null,8,["modelValue"]),t(u,{modelValue:o.value.costPrice,"onUpdate:modelValue":e[9]||(e[9]=a=>o.value.costPrice=a),name:"costPrice",type:"number",label:"成本价",placeholder:"请输入成本价",rules:[{required:!0,message:"请输入成本价"},{validator:z,message:"成本价必须大于0"}],onBlur:H},{button:n(()=>[...e[22]||(e[22]=[d("span",null,"元",-1)])]),_:1},8,["modelValue","rules"]),t(u,{modelValue:o.value.salePrice,"onUpdate:modelValue":e[10]||(e[10]=a=>o.value.salePrice=a),name:"salePrice",type:"number",label:"销售价",placeholder:"请输入销售价",rules:[{required:!0,message:"请输入销售价"},{validator:z,message:"销售价必须大于0"}],onBlur:J},{button:n(()=>[...e[23]||(e[23]=[d("span",null,"元",-1)])]),_:1},8,["modelValue","rules"]),t(u,{modelValue:o.value.stock,"onUpdate:modelValue":e[11]||(e[11]=a=>o.value.stock=a),name:"stock",type:"number",label:"库存数量",placeholder:"请输入库存数量",rules:[{required:!0,message:"请输入库存数量"},{validator:U,message:"库存必须为非负整数"}],onBlur:K},{button:n(()=>[...e[24]||(e[24]=[d("span",null,"件",-1)])]),_:1},8,["modelValue","rules"]),t(u,{modelValue:o.value.minStock,"onUpdate:modelValue":e[12]||(e[12]=a=>o.value.minStock=a),name:"minStock",type:"number",label:"最低库存",placeholder:"请输入最低库存预警值",rules:[{required:!0,message:"请输入最低库存"},{validator:U,message:"最低库存必须为非负整数"}],onBlur:Q},{button:n(()=>[...e[25]||(e[25]=[d("span",null,"件",-1)])]),_:1},8,["modelValue","rules"]),t(u,{modelValue:o.value.supplier,"onUpdate:modelValue":e[13]||(e[13]=a=>o.value.supplier=a),name:"supplier",label:"供应商",placeholder:"请输入供应商"},null,8,["modelValue"])]),_:1}),d("div",ge,[t(I,{round:"",block:"",type:"primary","native-type":"submit",size:"large"},{default:n(()=>[w(de(V.value?"保存修改":"添加商品"),1)]),_:1})])]),_:1})]),t(F,{show:g.value,"onUpdate:show":e[16]||(e[16]=a=>g.value=a),position:"bottom",round:"",closeable:""},{default:n(()=>[d("div",fe,[e[28]||(e[28]=d("div",{style:{"font-size":"16px","font-weight":"600","margin-bottom":"12px","text-align":"center"}}," 选择或输入分类 ",-1)),t(u,{modelValue:p.value,"onUpdate:modelValue":e[14]||(e[14]=a=>p.value=a),placeholder:"输入自定义分类",clearable:"",style:{"margin-bottom":"12px"}},null,8,["modelValue"]),t(I,{type:"primary",block:"",size:"small",style:{"margin-bottom":"16px"},onClick:j},{default:n(()=>[...e[26]||(e[26]=[w(" 使用自定义分类 ",-1)])]),_:1}),t(Z,{style:{margin:"12px 0"}},{default:n(()=>[...e[27]||(e[27]=[w("或选择常用分类",-1)])]),_:1})]),t(_,{columns:L.value,onConfirm:Y,onCancel:e[15]||(e[15]=a=>g.value=!1)},null,8,["columns"])]),_:1},8,["show"]),t(F,{show:b.value,"onUpdate:show":e[18]||(e[18]=a=>b.value=a),position:"bottom"},{default:n(()=>[t(_,{columns:M,onConfirm:G,onCancel:e[17]||(e[17]=a=>b.value=!1)})]),_:1},8,["show"])])}}},Ve=ae(be,[["__scopeId","data-v-8cb688c5"]]);export{Ve as default};
