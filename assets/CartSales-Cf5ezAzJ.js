import{_ as pe,i as _e,j as fe,B as ye,u as ke,r as v,k as b,o as he,c as m,d as o,b as s,w as u,m as L,n as g,l as be,a as ge,e as p,f as _,F as Q,p as R,t as l,s as c,g as r,v as we,q as Ce,h as Ve}from"./index-B03wA3Sl.js";const Pe={class:"cart-sales-page page-container"},xe={class:"content-wrapper"},ze={class:"card search-card"},Se={key:0,class:"search-results"},qe=["onClick"],Ue={class:"search-item-info"},Fe={class:"search-item-name"},$e={class:"search-item-detail"},Ie={class:"search-item-price"},Me={class:"card cart-card"},Ne={key:0,class:"empty-cart"},Ae={key:1,class:"cart-list"},Be={class:"cart-item-info"},Le={class:"cart-item-name"},Te={class:"cart-item-detail"},De={class:"cart-item-price"},Ee={class:"unit-price"},Ke={class:"item-total"},Qe={class:"cart-item-actions"},Re={class:"card member-card"},je={key:0,class:"member-info"},Ge={class:"member-row"},He={class:"member-value"},Je={class:"member-row"},Oe={class:"member-value balance"},We={class:"member-row"},Xe={class:"member-value discount"},Ye={class:"card"},Ze={class:"card"},es={class:"card"},ss={class:"checkout-bar"},ts={class:"checkout-info"},as={class:"checkout-row"},os={class:"checkout-row"},ls={key:0,class:"checkout-row"},ns={class:"discount-text"},is={class:"checkout-row total"},us={class:"total-price"},rs={class:"product-popup"},ds={class:"popup-header"},cs={class:"product-list"},vs=["onClick"],ms={class:"product-item-info"},ps={class:"product-item-name"},_s={class:"product-item-detail"},fs={class:"product-item-right"},ys={class:"product-item-price"},ks={class:"payment-dialog"},hs={class:"payment-summary"},bs={class:"payment-row"},gs={class:"payment-amount"},ws={key:1,class:"change-info"},Cs={class:"change-amount"},Vs={__name:"CartSales",setup(Ps){const Z=ge(),T=_e(),ee=fe(),D=ye(),U=ke(),V=v(""),P=v([]),F=v(""),x=v(!1),i=v([]),w=v(""),n=v(null),C=v(""),z=v(!1),y=v("ç°é‡‘"),$=v(""),E=v(!1),k=v(""),se=b(()=>U.activeUsers.map(a=>({text:a.name,value:a.name}))),te=b(()=>{let a=T.getAllProducts;if(F.value){const e=F.value.toLowerCase();a=a.filter(d=>d.name.toLowerCase().includes(e)||d.code&&d.code.toLowerCase().includes(e)||d.size&&d.size.toString().includes(e))}return a}),ae=b(()=>i.value.reduce((a,e)=>a+e.quantity,0)),K=b(()=>i.value.reduce((a,e)=>a+e.salePrice*e.quantity,0)),j=b(()=>!n.value||n.value.discount>=1?0:K.value*(1-n.value.discount)),h=b(()=>K.value-j.value),G=b(()=>{const a=parseFloat(k.value)||0;return Math.max(0,a-h.value)}),H=()=>{if(!V.value){P.value=[];return}const a=V.value.toLowerCase();P.value=T.getAllProducts.filter(e=>e.name.toLowerCase().includes(a)||e.code&&e.code.toLowerCase().includes(a)||e.size&&e.size.toString().includes(a)).slice(0,5)},J=()=>{},O=a=>{if(a.stock<=0){c("è¯¥å•†å“å·²å”®ç½„");return}const e=i.value.findIndex(d=>d.productId===a.id);if(e!==-1){if(i.value[e].quantity>=a.stock){c("åº“å­˜ä¸è¶³");return}i.value[e].quantity++}else i.value.push({productId:a.id,productName:a.name,size:a.size,salePrice:a.salePrice,costPrice:a.costPrice,quantity:1,stock:a.stock});V.value="",P.value=[],x.value=!1,c({message:"å·²æ·»åŠ åˆ°è´­ç‰©è½¦",icon:"cart-o"})},oe=a=>{},le=a=>{const e=i.value[a];e&&(!e.quantity||e.quantity<1?(e.quantity=1,c("æ•°é‡ä¸èƒ½å°äº1")):e.quantity>e.stock?(e.quantity=e.stock,c(`åº“å­˜ä¸è¶³ï¼Œæœ€å¤šåªèƒ½è´­ä¹°${e.stock}ä»¶`)):Number.isInteger(e.quantity)||(e.quantity=Math.floor(e.quantity),c("æ•°é‡å¿…é¡»ä¸ºæ•´æ•°")))},ne=a=>{i.value.splice(a,1)},ie=()=>{Ce({title:"æ¸…ç©ºè´­ç‰©è½¦",message:"ç¡®å®šè¦æ¸…ç©ºè´­ç‰©è½¦å—ï¼Ÿ"}).then(()=>{i.value=[],c("è´­ç‰©è½¦å·²æ¸…ç©º")}).catch(()=>{})},W=()=>{if(!w.value||w.value.length<11){n.value=null;return}const a=D.getMemberByPhone(w.value);a?(n.value=a,c({message:`æ¬¢è¿ä¼šå‘˜ ${a.name||a.phone}`,icon:"user-o"})):(n.value=null,c("æœªæ‰¾åˆ°è¯¥ä¼šå‘˜"))},ue=({selectedOptions:a})=>{C.value=a[0].text,z.value=!1},re=()=>{if(i.value.length===0){c("è´­ç‰©è½¦æ˜¯ç©ºçš„");return}if(!C.value){c("è¯·é€‰æ‹©é”€å”®å‘˜");return}if(y.value==="ä¼šå‘˜ä½™é¢"){if(!n.value){c("è¯·å…ˆé€‰æ‹©ä¼šå‘˜");return}if(n.value.balance<h.value){c("ä¼šå‘˜ä½™é¢ä¸è¶³");return}}k.value="",E.value=!0},de=a=>new Promise(e=>{var d,I;if(a==="confirm"){if(y.value==="ç°é‡‘"&&(parseFloat(k.value)||0)<h.value){c("æ”¶æ¬¾é‡‘é¢ä¸è¶³"),e(!1);return}const S={products:i.value.map(f=>({productId:f.productId,productName:f.productName,size:f.size,salePrice:f.salePrice,costPrice:f.costPrice,quantity:f.quantity})),salesperson:C.value,remark:$.value,discount:((d=n.value)==null?void 0:d.discount)||1,receivedAmount:parseFloat(k.value)||h.value,changeAmount:G.value,paymentMethod:y.value,memberId:((I=n.value)==null?void 0:I.id)||null},q=ee.addSale(S);q.success?(y.value==="ä¼šå‘˜ä½™é¢"&&n.value&&D.consumeMember(n.value.id,h.value),Ve({message:"æ”¶æ¬¾æˆåŠŸ",duration:2e3}),i.value=[],w.value="",n.value=null,$.value="",k.value="",e(!0)):(c(q.message||"é”€å”®å¤±è´¥"),e(!1))}else e(!0)});return he(()=>{T.loadProducts(),D.loadMembers(),U.loadUsers(),U.currentUserName&&(C.value=U.currentUserName)}),(a,e)=>{const d=p("van-icon"),I=p("van-nav-bar"),S=p("van-button"),q=p("van-search"),f=p("van-stepper"),M=p("van-field"),N=p("van-radio"),ce=p("van-radio-group"),X=p("van-tag"),Y=p("van-popup"),ve=p("van-picker"),me=p("van-dialog");return r(),m("div",Pe,[o(I,{title:"æ”¶é“¶å°","left-arrow":"",onClickLeft:e[0]||(e[0]=t=>be(Z).back())},{right:u(()=>[i.value.length>0?(r(),L(d,{key:0,name:"delete-o",size:"20",onClick:ie})):g("",!0)]),_:1}),s("div",xe,[s("div",ze,[o(q,{modelValue:V.value,"onUpdate:modelValue":e[2]||(e[2]=t=>V.value=t),placeholder:"æœç´¢è´§å·ã€é¢œè‰²ã€å°ºç ",onSearch:H,onClear:H,"show-action":""},{action:u(()=>[o(S,{size:"small",type:"primary",onClick:e[1]||(e[1]=t=>x.value=!0)},{default:u(()=>[...e[15]||(e[15]=[_(" é€‰æ‹©å•†å“ ",-1)])]),_:1})]),_:1},8,["modelValue"]),P.value.length>0?(r(),m("div",Se,[(r(!0),m(Q,null,R(P.value,t=>(r(),m("div",{key:t.id,class:"search-item",onClick:A=>O(t)},[s("div",Ue,[s("div",Fe,l(t.name),1),s("div",$e,l(t.size)+"ç  | åº“å­˜: "+l(t.stock),1)]),s("div",Ie,"Â¥"+l(t.salePrice),1)],8,qe))),128))])):g("",!0)]),s("div",Me,[e[18]||(e[18]=s("div",{class:"section-title"},"ğŸ›’ è´­ç‰©è½¦",-1)),i.value.length===0?(r(),m("div",Ne,[o(d,{name:"shopping-cart-o",size:"64",color:"#4A90E2"}),e[16]||(e[16]=s("p",{class:"empty-title"},"è´­ç‰©è½¦æ˜¯ç©ºçš„",-1)),e[17]||(e[17]=s("p",{class:"empty-tip"},"æœç´¢å•†å“æ·»åŠ åˆ°è´­ç‰©è½¦å¼€å§‹é”€å”®",-1))])):(r(),m("div",Ae,[(r(!0),m(Q,null,R(i.value,(t,A)=>(r(),m("div",{key:t.productId,class:"cart-item"},[s("div",Be,[s("div",Le,l(t.productName),1),s("div",Te,l(t.size)+"ç ",1),s("div",De,[s("span",Ee,"Â¥"+l(t.salePrice),1),s("span",Ke,"å°è®¡: Â¥"+l((t.salePrice*t.quantity).toFixed(2)),1)])]),s("div",Qe,[o(f,{modelValue:t.quantity,"onUpdate:modelValue":B=>t.quantity=B,min:1,max:t.stock,theme:"round","button-size":"22","disable-input":!1,onChange:B=>oe(),onBlur:B=>le(A)},null,8,["modelValue","onUpdate:modelValue","max","onChange","onBlur"]),o(d,{name:"delete-o",size:"20",color:"#ee0a24",onClick:B=>ne(A)},null,8,["onClick"])])]))),128))]))]),s("div",Re,[e[23]||(e[23]=s("div",{class:"section-title"},"ğŸ‘¤ ä¼šå‘˜ä¿¡æ¯",-1)),o(M,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=t=>w.value=t),label:"ä¼šå‘˜æ‰‹æœº",placeholder:"è¾“å…¥æ‰‹æœºå·æŸ¥è¯¢ä¼šå‘˜",type:"tel",maxlength:"11",clearable:"",onBlur:W},{button:u(()=>[o(S,{size:"small",type:"primary",onClick:W},{default:u(()=>[...e[19]||(e[19]=[_(" æŸ¥è¯¢ ",-1)])]),_:1})]),_:1},8,["modelValue"]),n.value?(r(),m("div",je,[s("div",Ge,[e[20]||(e[20]=s("span",{class:"member-label"},"ä¼šå‘˜å§“å:",-1)),s("span",He,l(n.value.name||"æœªè®¾ç½®"),1)]),s("div",Je,[e[21]||(e[21]=s("span",{class:"member-label"},"è´¦æˆ·ä½™é¢:",-1)),s("span",Oe,"Â¥"+l(n.value.balance.toFixed(2)),1)]),s("div",We,[e[22]||(e[22]=s("span",{class:"member-label"},"ä¼šå‘˜æŠ˜æ‰£:",-1)),s("span",Xe,l((n.value.discount*10).toFixed(1))+"æŠ˜",1)])])):g("",!0)]),s("div",Ye,[o(M,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=t=>C.value=t),label:"é”€å”®å‘˜",placeholder:"è¯·é€‰æ‹©é”€å”®å‘˜",readonly:"","is-link":"",onClick:e[5]||(e[5]=t=>z.value=!0)},null,8,["modelValue"])]),s("div",Ze,[e[28]||(e[28]=s("div",{class:"section-title"},"ğŸ’³ æ”¯ä»˜æ–¹å¼",-1)),o(ce,{modelValue:y.value,"onUpdate:modelValue":e[6]||(e[6]=t=>y.value=t),direction:"horizontal",class:"payment-group"},{default:u(()=>[o(N,{name:"ç°é‡‘"},{default:u(()=>[...e[24]||(e[24]=[_("ç°é‡‘",-1)])]),_:1}),o(N,{name:"å¾®ä¿¡"},{default:u(()=>[...e[25]||(e[25]=[_("å¾®ä¿¡",-1)])]),_:1}),o(N,{name:"æ”¯ä»˜å®"},{default:u(()=>[...e[26]||(e[26]=[_("æ”¯ä»˜å®",-1)])]),_:1}),o(N,{name:"ä¼šå‘˜ä½™é¢",disabled:!n.value||n.value.balance<h.value},{default:u(()=>[...e[27]||(e[27]=[_(" ä¼šå‘˜ä½™é¢ ",-1)])]),_:1},8,["disabled"])]),_:1},8,["modelValue"])]),s("div",es,[o(M,{modelValue:$.value,"onUpdate:modelValue":e[7]||(e[7]=t=>$.value=t),label:"å¤‡æ³¨",type:"textarea",placeholder:"è®¢å•å¤‡æ³¨ï¼ˆå¯é€‰ï¼‰",rows:"2",autosize:""},null,8,["modelValue"])])]),s("div",ss,[s("div",ts,[s("div",as,[e[29]||(e[29]=s("span",null,"å•†å“æ•°é‡:",-1)),s("span",null,l(ae.value)+"ä»¶",1)]),s("div",os,[e[30]||(e[30]=s("span",null,"å•†å“æ€»é¢:",-1)),s("span",null,"Â¥"+l(K.value.toFixed(2)),1)]),n.value&&n.value.discount<1?(r(),m("div",ls,[e[31]||(e[31]=s("span",null,"ä¼šå‘˜æŠ˜æ‰£:",-1)),s("span",ns,"-Â¥"+l(j.value.toFixed(2)),1)])):g("",!0),s("div",is,[e[32]||(e[32]=s("span",null,"åº”ä»˜é‡‘é¢:",-1)),s("span",us,"Â¥"+l(h.value.toFixed(2)),1)])]),o(S,{type:"primary",size:"large",disabled:i.value.length===0,onClick:re,class:"checkout-btn"},{default:u(()=>[_(" ç»“ç®— ("+l(i.value.length)+") ",1)]),_:1},8,["disabled"])]),o(Y,{show:x.value,"onUpdate:show":e[10]||(e[10]=t=>x.value=t),position:"bottom",style:{height:"70%"},round:""},{default:u(()=>[s("div",rs,[s("div",ds,[e[33]||(e[33]=s("span",{class:"popup-title"},"é€‰æ‹©å•†å“",-1)),o(d,{name:"cross",size:"20",onClick:e[8]||(e[8]=t=>x.value=!1)})]),o(q,{modelValue:F.value,"onUpdate:modelValue":e[9]||(e[9]=t=>F.value=t),placeholder:"æœç´¢å•†å“",onSearch:J,onClear:J},null,8,["modelValue"]),s("div",cs,[(r(!0),m(Q,null,R(te.value,t=>(r(),m("div",{key:t.id,class:we(["product-item",{"out-of-stock":t.stock<=0}]),onClick:A=>t.stock>0&&O(t)},[s("div",ms,[s("div",ps,l(t.name),1),s("div",_s,l(t.size)+"ç  | åº“å­˜: "+l(t.stock),1)]),s("div",fs,[s("div",ys,"Â¥"+l(t.salePrice),1),t.stock<=0?(r(),L(X,{key:0,type:"danger",size:"small"},{default:u(()=>[...e[34]||(e[34]=[_("ç¼ºè´§",-1)])]),_:1})):t.stock<=3?(r(),L(X,{key:1,type:"warning",size:"small"},{default:u(()=>[...e[35]||(e[35]=[_("åº“å­˜ç´§å¼ ",-1)])]),_:1})):g("",!0)])],10,vs))),128))])])]),_:1},8,["show"]),o(Y,{show:z.value,"onUpdate:show":e[12]||(e[12]=t=>z.value=t),position:"bottom",round:"",closeable:"","close-icon":"close",style:{paddingTop:"46px"}},{default:u(()=>[o(ve,{columns:se.value,onConfirm:ue,onCancel:e[11]||(e[11]=t=>z.value=!1),title:"é€‰æ‹©é”€å”®å‘˜"},null,8,["columns"])]),_:1},8,["show"]),o(me,{show:E.value,"onUpdate:show":e[14]||(e[14]=t=>E.value=t),title:"ç¡®è®¤æ”¶æ¬¾","show-cancel-button":"","before-close":de},{default:u(()=>[s("div",ks,[s("div",hs,[s("div",bs,[e[36]||(e[36]=s("span",null,"åº”ä»˜é‡‘é¢:",-1)),s("span",gs,"Â¥"+l(h.value.toFixed(2)),1)])]),y.value==="ç°é‡‘"?(r(),L(M,{key:0,modelValue:k.value,"onUpdate:modelValue":e[13]||(e[13]=t=>k.value=t),label:"æ”¶æ¬¾é‡‘é¢",type:"number",placeholder:"è¯·è¾“å…¥æ”¶æ¬¾é‡‘é¢"},{button:u(()=>[...e[37]||(e[37]=[_("å…ƒ",-1)])]),_:1},8,["modelValue"])):g("",!0),y.value==="ç°é‡‘"&&k.value?(r(),m("div",ws,[e[38]||(e[38]=s("span",null,"æ‰¾é›¶:",-1)),s("span",Cs,"Â¥"+l(G.value.toFixed(2)),1)])):g("",!0)])]),_:1},8,["show"])])}}},zs=pe(Vs,[["__scopeId","data-v-0ef6a982"]]);export{zs as default};
