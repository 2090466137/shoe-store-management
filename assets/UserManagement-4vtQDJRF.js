var $=(A,T,c)=>new Promise((h,b)=>{var o=g=>{try{p(c.next(g))}catch(U){b(U)}},a=g=>{try{p(c.throw(g))}catch(U){b(U)}},p=g=>g.done?h(g.value):Promise.resolve(g.value).then(o,a);p((c=c.apply(A,T)).next())});import{_ as ae,u as ne,r as M,k as C,I,o as oe,c as f,d as n,n as y,b as e,w as i,e as _,l as O,a as ie,t as d,f as m,F as ue,p as re,m as D,h as L,s as S,q as z,g as v,v as N,R as de}from"./index-B03wA3Sl.js";const ve={class:"user-management-page"},ce={key:0,class:"security-banner"},me={class:"banner-content"},pe={class:"banner-text"},fe={class:"stats-section"},_e={class:"stat-card"},ge={class:"stat-info"},we={class:"stat-value"},ye={class:"stat-card"},he={class:"stat-info"},be={class:"stat-value"},ke={class:"stat-card"},Ce={class:"stat-info"},Ue={class:"stat-value"},Ve={class:"user-list"},$e={class:"section-title"},Le={class:"count"},Se={class:"user-avatar"},Te={class:"avatar-text"},xe={class:"user-info"},Me={class:"user-name"},ze={key:0,class:"warning-tag"},Re={class:"user-meta"},De={key:0},Ne={class:"user-time"},Ae={key:0},Be={key:1,class:"never-login"},qe={key:0,class:"security-warning"},Ee={class:"user-actions"},Fe={class:"popup-content"},Pe={class:"popup-header"},Ie={class:"form-actions"},Oe={key:0,class:"reset-password-section"},je={class:"popup-content"},Ge={class:"popup-header"},He={class:"bottom-action"},Je={__name:"UserManagement",setup(A){const T=ie(),c=ne(),h=M(!1),b=M(!1),o=M(null),a=M({username:"",name:"",phone:"",role:"staff",password:""}),p=C(()=>c.getAllUsers),g=C(()=>p.value.filter(l=>l.role===I.MANAGER&&l.status==="active").length),U=C(()=>p.value.filter(l=>l.role===I.STAFF&&l.status==="active").length),j=C(()=>p.value.filter(l=>l.status!=="active").length),G=l=>de[l]||l,H=l=>{if(!l)return"";const s=new Date(l),w=new Date-s;return w<6e4?"åˆšåˆš":w<36e5?`${Math.floor(w/6e4)}åˆ†é’Ÿå‰`:w<864e5?`${Math.floor(w/36e5)}å°æ—¶å‰`:w<6048e5?`${Math.floor(w/864e5)}å¤©å‰`:`${s.getMonth()+1}/${s.getDate()}`},R=l=>l.id==="1"?!1:l.lastLoginTime?(Date.now()-l.lastLoginTime)/(1e3*60*60*24)>30:!0,B=C(()=>p.value.filter(l=>l.status==="active"&&R(l))),q=C(()=>B.value.length),J=C(()=>q.value>0),K=()=>{const l=B.value.map(s=>{const u=s.lastLoginTime?Math.floor((Date.now()-s.lastLoginTime)/864e5):"ä»æœª";return`${s.name}ï¼ˆ${s.username}ï¼‰- ${u==="ä»æœª"?"ä»æœªç™»å½•":u+"å¤©æœªç™»å½•"}`}).join(`
`);z({title:"âš ï¸ é£é™©è´¦å·åˆ—è¡¨",message:l,confirmButtonText:"çŸ¥é“äº†",showCancelButton:!1})},Q=l=>{o.value=l,a.value={username:l.username,name:l.name,phone:l.phone||"",role:l.role,password:""},h.value=!0},x=()=>{h.value=!1,o.value=null,a.value={username:"",name:"",phone:"",role:"staff",password:""}},W=()=>$(this,null,function*(){if(o.value){const l=yield c.updateUser(o.value.id,{username:a.value.username,name:a.value.name,phone:a.value.phone,role:a.value.role});l.success?(L("æ›´æ–°æˆåŠŸ"),x()):S(l.message)}else{const l=yield c.addUser({username:a.value.username,name:a.value.name,phone:a.value.phone,role:a.value.role,password:a.value.password||"123456"});l.success?(L("æ·»åŠ æˆåŠŸ"),x()):S(l.message)}}),X=l=>$(this,null,function*(){const s=l.status==="active"?"ç¦ç”¨":"å¯ç”¨";try{yield z({title:"ç¡®è®¤æ“ä½œ",message:`ç¡®å®šè¦${s}ç”¨æˆ· "${l.name}" å—ï¼Ÿ`});const u=yield c.toggleUserStatus(l.id);u.success?L(u.message):S(u.message)}catch(u){}}),Y=()=>$(this,null,function*(){if(o.value)try{yield z({title:"ç¡®è®¤åˆ é™¤",message:`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· "${o.value.name}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`});const l=yield c.deleteUser(o.value.id);l.success?(L("åˆ é™¤æˆåŠŸ"),x()):S(l.message)}catch(l){}}),Z=()=>$(this,null,function*(){if(o.value)try{yield z({title:"é‡ç½®å¯†ç ",message:`ç¡®å®šè¦å°†ç”¨æˆ· "${o.value.name}" çš„å¯†ç é‡ç½®ä¸º 123456 å—ï¼Ÿ`});const l=yield c.resetPassword(o.value.id);l.success?L(l.message):S(l.message)}catch(l){}});return oe(()=>{c.loadUsers()}),(l,s)=>{const u=_("van-icon"),w=_("van-nav-bar"),k=_("van-button"),V=_("van-field"),E=_("van-radio"),ee=_("van-radio-group"),se=_("van-cell-group"),le=_("van-form"),te=_("van-divider"),F=_("van-popup");return v(),f("div",ve,[n(w,{title:"ç”¨æˆ·ç®¡ç†","left-arrow":"",onClickLeft:s[2]||(s[2]=t=>O(T).back()),fixed:"",placeholder:""},{right:i(()=>[n(u,{name:"notes-o",size:"20",onClick:s[0]||(s[0]=t=>O(T).push("/operation-logs")),style:{"margin-right":"16px"}}),n(u,{name:"plus",size:"20",onClick:s[1]||(s[1]=t=>h.value=!0)})]),_:1}),J.value?(v(),f("div",ce,[s[14]||(s[14]=e("div",{class:"banner-icon"},"âš ï¸",-1)),e("div",me,[s[12]||(s[12]=e("div",{class:"banner-title"},"è´¦å·å®‰å…¨æé†’",-1)),e("div",pe," å‘ç° "+d(q.value)+" ä¸ªè´¦å·è¶…è¿‡30å¤©æœªç™»å½•ï¼Œå»ºè®®åŠæ—¶ç¦ç”¨ç¦»èŒå‘˜å·¥è´¦å· ",1)]),n(k,{size:"small",type:"warning",onClick:K},{default:i(()=>[...s[13]||(s[13]=[m(" æŸ¥çœ‹ ",-1)])]),_:1})])):y("",!0),e("div",fe,[e("div",_e,[s[16]||(s[16]=e("div",{class:"stat-icon manager"},"ğŸ‘‘",-1)),e("div",ge,[e("div",we,d(g.value),1),s[15]||(s[15]=e("div",{class:"stat-label"},"åº—é•¿",-1))])]),e("div",ye,[s[18]||(s[18]=e("div",{class:"stat-icon staff"},"ğŸ‘¤",-1)),e("div",he,[e("div",be,d(U.value),1),s[17]||(s[17]=e("div",{class:"stat-label"},"åº—å‘˜",-1))])]),e("div",ke,[s[20]||(s[20]=e("div",{class:"stat-icon disabled"},"â¸ï¸",-1)),e("div",Ce,[e("div",Ue,d(j.value),1),s[19]||(s[19]=e("div",{class:"stat-label"},"å·²ç¦ç”¨",-1))])])]),e("div",Ve,[e("div",$e,[s[21]||(s[21]=e("span",null,"ç”¨æˆ·åˆ—è¡¨",-1)),e("span",Le,"å…± "+d(p.value.length)+" äºº",1)]),(v(!0),f(ue,null,re(p.value,t=>(v(),f("div",{key:t.id,class:N(["user-card",{disabled:t.status!=="active"}])},[e("div",Se,[e("span",Te,d(t.name.charAt(0)),1),e("span",{class:N(["status-dot",t.status==="active"?"online":"offline"])},null,2)]),e("div",xe,[e("div",Me,[m(d(t.name)+" ",1),e("span",{class:N(["role-tag",t.role])},d(G(t.role)),3),R(t)?(v(),f("span",ze," âš ï¸ é•¿æœŸæœªç™»å½• ")):y("",!0)]),e("div",Re,[e("span",null,"è´¦å·: "+d(t.username),1),t.phone?(v(),f("span",De,"Â· "+d(t.phone),1)):y("",!0)]),e("div",Ne,[t.lastLoginTime?(v(),f("span",Ae," æœ€åç™»å½•: "+d(H(t.lastLoginTime)),1)):(v(),f("span",Be,"ä»æœªç™»å½•"))]),R(t)&&t.status==="active"?(v(),f("div",qe," âš ï¸ å»ºè®®ç¦ç”¨ï¼šè¯¥è´¦å·è¶…è¿‡30å¤©æœªç™»å½•ï¼Œå¯èƒ½å­˜åœ¨å®‰å…¨é£é™© ")):y("",!0)]),e("div",Ee,[n(k,{size:"small",type:"primary",plain:"",onClick:r=>Q(t)},{default:i(()=>[...s[22]||(s[22]=[m(" ç¼–è¾‘ ",-1)])]),_:1},8,["onClick"]),t.id!=="1"?(v(),D(k,{key:0,size:"small",type:t.status==="active"?"warning":"success",plain:"",onClick:r=>X(t)},{default:i(()=>[m(d(t.status==="active"?"ç¦ç”¨":"å¯ç”¨"),1)]),_:2},1032,["type","onClick"])):y("",!0)])],2))),128))]),n(F,{show:h.value,"onUpdate:show":s[8]||(s[8]=t=>h.value=t),position:"bottom",round:"",style:{height:"70%"}},{default:i(()=>[e("div",Fe,[e("div",Pe,[e("span",null,d(o.value?"ç¼–è¾‘ç”¨æˆ·":"æ·»åŠ ç”¨æˆ·"),1),n(u,{name:"cross",onClick:x})]),n(le,{onSubmit:W,class:"user-form"},{default:i(()=>[n(se,{inset:""},{default:i(()=>{var t;return[n(V,{modelValue:a.value.username,"onUpdate:modelValue":s[3]||(s[3]=r=>a.value.username=r),name:"username",label:"è´¦å·",placeholder:"è¯·è¾“å…¥ç™»å½•è´¦å·",rules:[{required:!0,message:"è¯·è¾“å…¥è´¦å·"}],disabled:((t=o.value)==null?void 0:t.role)==="admin"},null,8,["modelValue","disabled"]),n(V,{modelValue:a.value.name,"onUpdate:modelValue":s[4]||(s[4]=r=>a.value.name=r),name:"name",label:"å§“å",placeholder:"è¯·è¾“å…¥å§“å",rules:[{required:!0,message:"è¯·è¾“å…¥å§“å"}]},null,8,["modelValue"]),n(V,{modelValue:a.value.phone,"onUpdate:modelValue":s[5]||(s[5]=r=>a.value.phone=r),name:"phone",label:"æ‰‹æœºå·",placeholder:"è¯·è¾“å…¥æ‰‹æœºå·ï¼ˆé€‰å¡«ï¼‰",type:"tel"},null,8,["modelValue"]),n(V,{name:"role",label:"è§’è‰²",rules:[{required:!0,message:"è¯·é€‰æ‹©è§’è‰²"}]},{input:i(()=>[n(ee,{modelValue:a.value.role,"onUpdate:modelValue":s[6]||(s[6]=r=>a.value.role=r),direction:"horizontal"},{default:i(()=>{var r,P;return[n(E,{name:"manager",disabled:((r=o.value)==null?void 0:r.role)==="admin"},{default:i(()=>[...s[23]||(s[23]=[m(" åº—é•¿ ",-1)])]),_:1},8,["disabled"]),n(E,{name:"staff",disabled:((P=o.value)==null?void 0:P.role)==="admin"},{default:i(()=>[...s[24]||(s[24]=[m(" åº—å‘˜ ",-1)])]),_:1},8,["disabled"])]}),_:1},8,["modelValue"])]),_:1}),o.value?y("",!0):(v(),D(V,{key:0,modelValue:a.value.password,"onUpdate:modelValue":s[7]||(s[7]=r=>a.value.password=r),name:"password",label:"å¯†ç ",placeholder:"é»˜è®¤å¯†ç : 123456"},null,8,["modelValue"]))]}),_:1}),e("div",Ie,[n(k,{round:"",block:"",type:"primary","native-type":"submit"},{default:i(()=>[m(d(o.value?"ä¿å­˜ä¿®æ”¹":"æ·»åŠ ç”¨æˆ·"),1)]),_:1}),o.value&&o.value.role!=="admin"?(v(),D(k,{key:0,round:"",block:"",type:"danger",plain:"",onClick:Y,style:{"margin-top":"10px"}},{default:i(()=>[...s[25]||(s[25]=[m(" åˆ é™¤ç”¨æˆ· ",-1)])]),_:1})):y("",!0)])]),_:1}),o.value?(v(),f("div",Oe,[n(te,null,{default:i(()=>[...s[26]||(s[26]=[m("å¯†ç ç®¡ç†",-1)])]),_:1}),n(k,{size:"small",type:"warning",plain:"",block:"",onClick:Z},{default:i(()=>[...s[27]||(s[27]=[m(" é‡ç½®å¯†ç ä¸º 123456 ",-1)])]),_:1})])):y("",!0)])]),_:1},8,["show"]),n(F,{show:b.value,"onUpdate:show":s[10]||(s[10]=t=>b.value=t),position:"bottom",round:"",style:{height:"60%"}},{default:i(()=>[e("div",je,[e("div",Ge,[s[28]||(s[28]=e("span",null,"æƒé™è¯´æ˜",-1)),n(u,{name:"cross",onClick:s[9]||(s[9]=t=>b.value=!1)})]),s[29]||(s[29]=e("div",{class:"permission-info"},[e("div",{class:"role-section"},[e("div",{class:"role-header admin"},[e("span",{class:"role-icon"},"ğŸ‘‘"),e("span",{class:"role-title"},"ç®¡ç†å‘˜")]),e("ul",{class:"permission-list"},[e("li",null,"âœ… æ‰€æœ‰åŠŸèƒ½å®Œå…¨è®¿é—®"),e("li",null,"âœ… ç”¨æˆ·ç®¡ç†ï¼ˆæ·»åŠ /ç¼–è¾‘/åˆ é™¤ï¼‰"),e("li",null,"âœ… æ•°æ®ç®¡ç†ï¼ˆå¤‡ä»½/æ¢å¤/æ¸…é™¤ï¼‰"),e("li",null,"âœ… ç³»ç»Ÿè®¾ç½®")])]),e("div",{class:"role-section"},[e("div",{class:"role-header manager"},[e("span",{class:"role-icon"},"ğŸ’¼"),e("span",{class:"role-title"},"åº—é•¿")]),e("ul",{class:"permission-list"},[e("li",null,"âœ… å•†å“ç®¡ç†ï¼ˆå¢åˆ æ”¹æŸ¥ï¼‰"),e("li",null,"âœ… è¿›è´§ç®¡ç†"),e("li",null,"âœ… é”€å”®ç®¡ç†"),e("li",null,"âœ… é€€æ¢è´§å¤„ç†"),e("li",null,"âœ… ä¼šå‘˜ç®¡ç†"),e("li",null,"âœ… æŸ¥çœ‹æ‰€æœ‰ç»Ÿè®¡æŠ¥è¡¨"),e("li",null,"âœ… åº“å­˜ç›˜ç‚¹"),e("li",null,"âœ… æŸ¥çœ‹æ‰€æœ‰å‘˜å·¥ä¸šç»©"),e("li",null,"âœ… æ•°æ®å¤‡ä»½/æ¢å¤"),e("li",null,"âŒ ç”¨æˆ·ç®¡ç†"),e("li",null,"âŒ æ•°æ®æ¸…é™¤")])]),e("div",{class:"role-section"},[e("div",{class:"role-header staff"},[e("span",{class:"role-icon"},"ğŸ‘¤"),e("span",{class:"role-title"},"åº—å‘˜")]),e("ul",{class:"permission-list"},[e("li",null,"âœ… æŸ¥çœ‹å•†å“"),e("li",null,"âœ… é”€å”®å¼€å•"),e("li",null,"âœ… æŸ¥çœ‹é”€å”®è®°å½•"),e("li",null,"âœ… æŸ¥çœ‹é€€æ¢è´§è®°å½•"),e("li",null,"âœ… ä¼šå‘˜æŸ¥çœ‹/æ·»åŠ /å……å€¼"),e("li",null,"âœ… æŸ¥çœ‹åŸºæœ¬ç»Ÿè®¡"),e("li",null,"âœ… æŸ¥çœ‹ä¸ªäººä¸šç»©"),e("li",null,"âŒ å•†å“å¢åˆ æ”¹"),e("li",null,"âŒ è¿›è´§ç®¡ç†"),e("li",null,"âŒ é€€æ¢è´§å¤„ç†"),e("li",null,"âŒ åˆ©æ¶¦æ•°æ®"),e("li",null,"âŒ åº“å­˜ç›˜ç‚¹")])])],-1))])]),_:1},8,["show"]),e("div",He,[n(k,{type:"default",size:"small",icon:"question-o",onClick:s[11]||(s[11]=t=>b.value=!0)},{default:i(()=>[...s[30]||(s[30]=[m(" æŸ¥çœ‹æƒé™è¯´æ˜ ",-1)])]),_:1})])])}}},We=ae(Je,[["__scopeId","data-v-0f5d5119"]]);export{We as default};
