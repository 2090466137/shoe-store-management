var f=(_,u,s)=>new Promise((o,t)=>{var n=e=>{try{a(s.next(e))}catch(l){t(l)}},g=e=>{try{a(s.throw(e))}catch(l){t(l)}},a=e=>e.done?o(e.value):Promise.resolve(e.value).then(n,g);a((s=s.apply(_,u)).next())});import{_ as U,u as V,r as w,o as x,a as I,c as k,b as r,d as c,w as p,e as m,f as b,g as T,s as v,h as N}from"./index-CMxW_jqh.js";const P={class:"login-page"},A={class:"login-card"},L={class:"remember-section"},B={class:"login-btn-wrapper"},M={__name:"Login",setup(_){const u=I(),s=V(),o=w({username:"",password:""}),t=w(!1),n=w(!1),g=()=>f(this,null,function*(){n.value=!0;try{if(!s.users||s.users.length===0){console.log("ç”¨æˆ·æ•°æ®ä¸ºç©ºï¼Œå¼€å§‹åŠ è½½...");const e=s.loadUsers(),l=new Promise(i=>setTimeout(i,3e3));yield Promise.race([e,l]),(!s.users||s.users.length===0)&&console.warn("ç”¨æˆ·æ•°æ®åŠ è½½è¶…æ—¶æˆ–å¤±è´¥ï¼Œlogin å‡½æ•°å°†ä½¿ç”¨é»˜è®¤ç”¨æˆ·")}if(!o.value.username||!o.value.password){v("è¯·è¾“å…¥è´¦å·å’Œå¯†ç "),n.value=!1;return}yield new Promise(e=>setTimeout(e,100));const a=yield s.login(o.value.username,o.value.password);if(a.success){if(t.value?localStorage.setItem("rememberedAccount",JSON.stringify({username:o.value.username,password:o.value.password})):localStorage.removeItem("rememberedAccount"),N("ç™»å½•æˆåŠŸ"),!localStorage.getItem("currentUser")){console.error("ç™»å½•æˆåŠŸä½† currentUser æœªè®¾ç½®"),v("ç™»å½•çŠ¶æ€å¼‚å¸¸ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•"),n.value=!1;return}console.log("å‡†å¤‡è·³è½¬åˆ°é¦–é¡µ..."),console.log("currentUser:",localStorage.getItem("currentUser"));try{yield u.push("/home"),console.log("router.push æˆåŠŸï¼Œå·²è·³è½¬åˆ°é¦–é¡µ")}catch(l){console.warn("router.push å¤±è´¥ï¼Œå°è¯• replace:",l);try{yield u.replace("/home"),console.log("router.replace æˆåŠŸ")}catch(i){console.error("router.replace ä¹Ÿå¤±è´¥ï¼Œä½¿ç”¨ window.location:",i),setTimeout(()=>{window.location.href="/home"},100)}}}else v(a.message||"ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•")}catch(a){console.error("ç™»å½•é”™è¯¯:",a),v("ç™»å½•å¤±è´¥ï¼Œè¯·é‡è¯•")}finally{n.value=!1}});return x(()=>f(this,null,function*(){try{yield s.loadUsers()}catch(e){console.error("åŠ è½½ç”¨æˆ·æ•°æ®å¤±è´¥:",e)}if(s.isLoggedIn){u.replace("/home");return}const a=localStorage.getItem("rememberedAccount");if(a)try{const e=JSON.parse(a);o.value.username=e.username,o.value.password=e.password,t.value=!0}catch(e){console.error("åŠ è½½è®°ä½çš„è´¦å·å¤±è´¥:",e),localStorage.removeItem("rememberedAccount")}})),(a,e)=>{const l=m("van-field"),i=m("van-cell-group"),h=m("van-checkbox"),y=m("van-button"),S=m("van-form");return T(),k("div",P,[e[6]||(e[6]=r("div",{class:"bg-decoration"},[r("div",{class:"circle circle-1"}),r("div",{class:"circle circle-2"}),r("div",{class:"circle circle-3"})],-1)),r("div",A,[e[5]||(e[5]=r("div",{class:"logo-section"},[r("div",{class:"logo"},"ğŸ‘Ÿ"),r("h1",{class:"app-name"},"é‹åº—ç®¡ç†ç³»ç»Ÿ"),r("p",{class:"app-desc"},"Shoe Store Management")],-1)),c(S,{onSubmit:g},{default:p(()=>[c(i,{inset:""},{default:p(()=>[c(l,{modelValue:o.value.username,"onUpdate:modelValue":e[0]||(e[0]=d=>o.value.username=d),name:"username",label:"è´¦å·",placeholder:"è¯·è¾“å…¥è´¦å·",rules:[{required:!0,message:"è¯·è¾“å…¥è´¦å·"}],"left-icon":"user-o"},null,8,["modelValue"]),c(l,{modelValue:o.value.password,"onUpdate:modelValue":e[1]||(e[1]=d=>o.value.password=d),type:"password",name:"password",label:"å¯†ç ",placeholder:"è¯·è¾“å…¥å¯†ç ",rules:[{required:!0,message:"è¯·è¾“å…¥å¯†ç "}],"left-icon":"lock"},null,8,["modelValue"])]),_:1}),r("div",L,[c(h,{modelValue:t.value,"onUpdate:modelValue":e[2]||(e[2]=d=>t.value=d),"icon-size":"18px"},{default:p(()=>[...e[3]||(e[3]=[b("è®°ä½å¯†ç ",-1)])]),_:1},8,["modelValue"])]),r("div",B,[c(y,{round:"",block:"",type:"primary","native-type":"submit",loading:n.value,"loading-text":"ç™»å½•ä¸­..."},{default:p(()=>[...e[4]||(e[4]=[b(" ç™»å½• ",-1)])]),_:1},8,["loading"])])]),_:1})]),e[7]||(e[7]=r("div",{class:"version-info"}," v3.2 | Â© 2025 é‹åº—ç®¡ç†ç³»ç»Ÿ ",-1)),e[8]||(e[8]=r("div",{class:"copyright-info"}," Â© 2026 é‹åº—ç®¡ç†ç³»ç»Ÿ Â· æŠ€æœ¯æ”¯æŒ ",-1))])}}},E=U(M,[["__scopeId","data-v-5cf3d780"]]);export{E as default};
