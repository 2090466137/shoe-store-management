var E=(F,N,h)=>new Promise((v,m)=>{var i=u=>{try{d(h.next(u))}catch(k){m(k)}},f=u=>{try{d(h.throw(u))}catch(k){m(k)}},d=u=>u.done?v(u.value):Promise.resolve(u.value).then(i,f);d((h=h.apply(F,N)).next())});import{_ as ce,i as ie,r,k as V,o as ue,c as n,d as c,b as t,w as p,m as B,l as re,a as de,e as _,n as $,t as o,f as H,F as K,p as Y,g as l,v as j,x as ve,s as C,q as ke}from"./index.g74vrd7P.js";import{s as pe}from"./search.CbM0cuqP.js";const _e={class:"inventory-page page-container"},he={class:"content-wrapper"},me={key:0,class:"status-card card"},fe={class:"status-header"},ye={class:"status-time"},ge={class:"status-stats"},Se={class:"status-item"},Ce={class:"status-value"},be={class:"status-item"},we={class:"status-value error"},Ie={key:1,class:"quick-actions card"},Ve={key:2,class:"check-list"},$e={class:"search-wrapper"},ze={class:"filter-tabs"},De={class:"product-list"},Te=["onClick"],xe={class:"item-image"},He=["src","alt"],Ne={key:0,class:"check-status"},Ue={class:"item-info"},qe={class:"item-name"},Be={class:"item-spec"},Fe={class:"item-stocks"},Me={class:"system-stock"},Pe={key:1,class:"unchecked-tag"},Je={class:"item-action"},Le={key:1,class:"difference-badge"},Oe={key:0,class:"plus"},Re={key:1,class:"minus"},Ae={key:2,class:"equal"},Ee={key:3,class:"result-section"},Ke={class:"result-card card"},Ye={class:"result-summary"},je={class:"result-item"},Ge={class:"result-value"},Qe={class:"result-item"},We={class:"result-value success"},Xe={class:"result-item"},Ze={class:"result-value error"},es={class:"check-dialog-content"},ss={class:"dialog-product-info"},ts={class:"dialog-product-name"},as={class:"dialog-product-spec"},os={class:"history-popup"},ls={class:"history-header"},ns={class:"history-list"},cs=["onClick"],is={class:"history-info"},us={class:"history-date"},rs={class:"history-meta"},ds={__name:"Inventory",setup(F){const N=de(),h=ie(),v=r(!1),m=r(null),i=r([]),f=r(""),d=r("all"),u=r(!1),k=r(null),y=r(""),b=r(""),z=r(!1),D=r([]),g=V(()=>i.value.length),w=V(()=>i.value.filter(a=>a.checked).length),U=V(()=>i.value.filter(a=>a.checked&&a.actualStock!==a.systemStock).length),M=V(()=>i.value.filter(a=>a.checked&&a.actualStock===a.systemStock).length),G=V(()=>{let a=i.value;return f.value&&(a=pe(a,f.value)),d.value==="unchecked"?a=a.filter(e=>!e.checked):d.value==="difference"?a=a.filter(e=>e.checked&&e.actualStock!==e.systemStock):d.value==="checked"&&(a=a.filter(e=>e.checked)),a}),P=()=>{const a=h.getAllProducts;if(a.length===0){C("æš‚æ— å•†å“ï¼Œæ— æ³•è¿›è¡Œç›˜ç‚¹");return}v.value=!0,m.value={id:Date.now().toString(),startTime:Date.now(),endTime:null},i.value=a.map(e=>({productId:e.id,name:e.name,code:e.code,size:e.size,color:e.color,image:e.image,systemStock:e.stock,actualStock:null,checked:!1,remark:""})),C("ç›˜ç‚¹å·²å¼€å§‹")},J=a=>{k.value=a,y.value=a.checked?a.actualStock.toString():"",b.value=a.remark||"",u.value=!0},Q=()=>{if(!y.value&&y.value!=="0"){C("è¯·è¾“å…¥å®é™…åº“å­˜");return}const a=parseInt(y.value),e=i.value.find(S=>S.productId===k.value.productId);e&&(e.actualStock=a,e.checked=!0,e.remark=b.value),C("ç›˜ç‚¹æˆåŠŸ"),y.value="",b.value=""},L=()=>E(this,null,function*(){if(w.value<g.value&&!(yield ke({title:"æç¤º",message:`è¿˜æœ‰ ${g.value-w.value} ç§å•†å“æœªç›˜ç‚¹ï¼Œç¡®å®šè¦å®Œæˆç›˜ç‚¹å—ï¼Ÿ`}).catch(()=>!1)))return;for(const e of i.value)e.checked&&(yield h.updateProduct(e.productId,{stock:e.actualStock}));const a={id:m.value.id,startTime:m.value.startTime,endTime:Date.now(),totalCount:g.value,checkedCount:w.value,differenceCount:U.value,matchCount:M.value,items:i.value.filter(e=>e.checked)};D.value.unshift(a),se(),C({type:"success",message:"ç›˜ç‚¹å®Œæˆï¼Œåº“å­˜å·²æ›´æ–°"}),v.value=!1,m.value=null,i.value=[],d.value="all",f.value=""}),W=a=>{C("å†å²è¯¦æƒ…åŠŸèƒ½å¾…å¼€å‘")},X=()=>{},Z=()=>{},O=a=>{const e=new Date(a);return`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")} ${String(e.getHours()).padStart(2,"0")}:${String(e.getMinutes()).padStart(2,"0")}`},ee=()=>{const a=localStorage.getItem("inventoryHistory");a&&(D.value=JSON.parse(a))},se=()=>{localStorage.setItem("inventoryHistory",JSON.stringify(D.value))};return ue(()=>{h.loadProducts(),ee()}),(a,e)=>{const S=_("van-icon"),te=_("van-nav-bar"),T=_("van-button"),ae=_("van-search"),x=_("van-tab"),oe=_("van-tabs"),R=_("van-field"),le=_("van-dialog"),ne=_("van-popup");return l(),n("div",_e,[c(te,{title:"åº“å­˜ç›˜ç‚¹","left-arrow":"",onClickLeft:e[0]||(e[0]=s=>re(N).back())},{right:p(()=>[v.value?(l(),B(S,{key:1,name:"success",size:"22",onClick:L})):(l(),B(S,{key:0,name:"add-o",size:"22",onClick:P}))]),_:1}),t("div",he,[v.value?(l(),n("div",me,[t("div",fe,[e[9]||(e[9]=t("span",{class:"status-badge checking"},"ç›˜ç‚¹ä¸­",-1)),t("span",ye,o(O(m.value.startTime)),1)]),t("div",ge,[t("div",Se,[e[10]||(e[10]=t("span",{class:"status-label"},"å·²ç›˜ç‚¹",-1)),t("span",Ce,o(w.value)+"/"+o(g.value),1)]),t("div",be,[e[11]||(e[11]=t("span",{class:"status-label"},"å·®å¼‚æ•°",-1)),t("span",we,o(U.value),1)])])])):$("",!0),v.value?$("",!0):(l(),n("div",Ie,[c(T,{type:"primary",size:"large",block:"",icon:"plus",onClick:P},{default:p(()=>[...e[12]||(e[12]=[H(" å¼€å§‹æ–°ç›˜ç‚¹ ",-1)])]),_:1}),c(T,{type:"default",size:"large",block:"",icon:"records",onClick:e[1]||(e[1]=s=>z.value=!0),style:{"margin-top":"12px"}},{default:p(()=>[...e[13]||(e[13]=[H(" æŸ¥çœ‹å†å²è®°å½• ",-1)])]),_:1})])),v.value?(l(),n("div",Ve,[t("div",$e,[c(ae,{modelValue:f.value,"onUpdate:modelValue":e[2]||(e[2]=s=>f.value=s),placeholder:"æœç´¢å•†å“",onSearch:X},null,8,["modelValue"])]),t("div",ze,[c(oe,{active:d.value,"onUpdate:active":e[3]||(e[3]=s=>d.value=s),onChange:Z},{default:p(()=>[c(x,{title:"å…¨éƒ¨",name:"all"}),c(x,{title:"æœªç›˜ç‚¹",name:"unchecked"}),c(x,{title:"æœ‰å·®å¼‚",name:"difference"}),c(x,{title:"å·²å®Œæˆ",name:"checked"})]),_:1},8,["active"])]),t("div",De,[(l(!0),n(K,null,Y(G.value,s=>(l(),n("div",{key:s.productId,class:j(["check-item",{"has-difference":s.checked&&s.actualStock!==s.systemStock,checked:s.checked}]),onClick:I=>J(s)},[t("div",xe,[t("img",{src:s.image||"https://via.placeholder.com/60",alt:s.name},null,8,He),s.checked?(l(),n("div",Ne,[c(S,{name:"success",color:"#07c160"})])):$("",!0)]),t("div",Ue,[t("div",qe,o(s.name),1),t("div",Be,"è´§å·: "+o(s.code)+" | "+o(s.size)+"ç  | "+o(s.color),1),t("div",Fe,[t("span",Me,"ç³»ç»Ÿ: "+o(s.systemStock),1),s.checked?(l(),n("span",{key:0,class:j(["actual-stock",{difference:s.actualStock!==s.systemStock}])}," å®é™…: "+o(s.actualStock),3)):(l(),n("span",Pe,"æœªç›˜ç‚¹"))])]),t("div",Je,[s.checked?(l(),n("div",Le,[s.actualStock>s.systemStock?(l(),n("span",Oe," +"+o(s.actualStock-s.systemStock),1)):s.actualStock<s.systemStock?(l(),n("span",Re,o(s.actualStock-s.systemStock),1)):(l(),n("span",Ae,"âœ“"))])):(l(),B(T,{key:0,type:"primary",size:"small",onClick:ve(I=>J(s),["stop"])},{default:p(()=>[...e[14]||(e[14]=[H(" ç›˜ç‚¹ ",-1)])]),_:1},8,["onClick"]))])],10,Te))),128))])])):$("",!0),v.value&&w.value===g.value?(l(),n("div",Ee,[t("div",Ke,[e[19]||(e[19]=t("div",{class:"result-title"},"ğŸ“‹ ç›˜ç‚¹å®Œæˆ",-1)),t("div",Ye,[t("div",je,[e[15]||(e[15]=t("span",{class:"result-label"},"ç›˜ç‚¹å•†å“",-1)),t("span",Ge,o(g.value)+" ç§",1)]),t("div",Qe,[e[16]||(e[16]=t("span",{class:"result-label"},"åº“å­˜ä¸€è‡´",-1)),t("span",We,o(M.value)+" ç§",1)]),t("div",Xe,[e[17]||(e[17]=t("span",{class:"result-label"},"åº“å­˜å·®å¼‚",-1)),t("span",Ze,o(U.value)+" ç§",1)])]),c(T,{type:"primary",size:"large",block:"",onClick:L},{default:p(()=>[...e[18]||(e[18]=[H(" å®Œæˆç›˜ç‚¹å¹¶æ›´æ–°åº“å­˜ ",-1)])]),_:1})])])):$("",!0)]),c(le,{show:u.value,"onUpdate:show":e[6]||(e[6]=s=>u.value=s),title:"ç›˜ç‚¹å•†å“","show-cancel-button":"",onConfirm:Q},{default:p(()=>{var s,I,A;return[t("div",es,[t("div",ss,[t("div",ts,o((s=k.value)==null?void 0:s.name),1),t("div",as,o((I=k.value)==null?void 0:I.brand)+" | "+o((A=k.value)==null?void 0:A.size)+"ç  ",1)]),c(R,{modelValue:y.value,"onUpdate:modelValue":e[4]||(e[4]=q=>y.value=q),type:"number",label:"å®é™…åº“å­˜",placeholder:"è¯·è¾“å…¥å®é™…åº“å­˜æ•°é‡",rules:[{required:!0,message:"è¯·è¾“å…¥å®é™…åº“å­˜"}]},{button:p(()=>[...e[20]||(e[20]=[t("span",null,"ä»¶",-1)])]),_:1},8,["modelValue"]),c(R,{modelValue:b.value,"onUpdate:modelValue":e[5]||(e[5]=q=>b.value=q),type:"textarea",label:"å¤‡æ³¨",placeholder:"å¦‚æœ‰å·®å¼‚ï¼Œè¯·è¯´æ˜åŸå› ï¼ˆé€‰å¡«ï¼‰",rows:"2",maxlength:"100","show-word-limit":""},null,8,["modelValue"])])]}),_:1},8,["show"]),c(ne,{show:z.value,"onUpdate:show":e[8]||(e[8]=s=>z.value=s),position:"bottom",style:{height:"80%"}},{default:p(()=>[t("div",os,[t("div",ls,[e[21]||(e[21]=t("span",{class:"history-title"},"ç›˜ç‚¹å†å²",-1)),c(S,{name:"cross",onClick:e[7]||(e[7]=s=>z.value=!1)})]),t("div",ns,[(l(!0),n(K,null,Y(D.value,s=>(l(),n("div",{key:s.id,class:"history-item",onClick:I=>W(s)},[t("div",is,[t("div",us,o(O(s.startTime)),1),t("div",rs,o(s.totalCount)+"ç§å•†å“ | "+o(s.differenceCount)+"å¤„å·®å¼‚ ",1)]),e[22]||(e[22]=t("div",{class:"history-status"},[t("span",{class:"status-badge completed"},"å·²å®Œæˆ")],-1))],8,cs))),128))])])]),_:1},8,["show"])])}}},_s=ce(ds,[["__scopeId","data-v-0007f4e9"]]);export{_s as default};
